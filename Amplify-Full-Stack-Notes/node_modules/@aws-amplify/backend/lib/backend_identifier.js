import { CDKContextKey } from '@aws-amplify/platform-core';
/**
 * Populates a backend identifier based on CDK context values.
 */
export const getBackendIdentifier = (scope) => {
    const backendNamespace = scope.node.getContext(CDKContextKey.BACKEND_NAMESPACE);
    if (typeof backendNamespace !== 'string') {
        throw new Error(`${CDKContextKey.BACKEND_NAMESPACE} CDK context value is not a string`);
    }
    const backendName = scope.node.getContext(CDKContextKey.BACKEND_NAME);
    if (typeof backendName !== 'string') {
        throw new Error(`${CDKContextKey.BACKEND_NAME} CDK context value is not a string`);
    }
    const deploymentType = scope.node.getContext(CDKContextKey.DEPLOYMENT_TYPE);
    const expectedDeploymentTypeValues = ['sandbox', 'branch'];
    if (!expectedDeploymentTypeValues.includes(deploymentType)) {
        throw new Error(`${CDKContextKey.DEPLOYMENT_TYPE} CDK context value is not in (${expectedDeploymentTypeValues.join(', ')})`);
    }
    return {
        type: deploymentType,
        namespace: backendNamespace,
        name: backendName,
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2VuZF9pZGVudGlmaWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2JhY2tlbmRfaWRlbnRpZmllci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFHM0Q7O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEtBQWdCLEVBQXFCLEVBQUU7SUFDMUUsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FDNUMsYUFBYSxDQUFDLGlCQUFpQixDQUNoQyxDQUFDO0lBQ0YsSUFBSSxPQUFPLGdCQUFnQixLQUFLLFFBQVEsRUFBRTtRQUN4QyxNQUFNLElBQUksS0FBSyxDQUNiLEdBQUcsYUFBYSxDQUFDLGlCQUFpQixvQ0FBb0MsQ0FDdkUsQ0FBQztLQUNIO0lBRUQsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRXRFLElBQUksT0FBTyxXQUFXLEtBQUssUUFBUSxFQUFFO1FBQ25DLE1BQU0sSUFBSSxLQUFLLENBQ2IsR0FBRyxhQUFhLENBQUMsWUFBWSxvQ0FBb0MsQ0FDbEUsQ0FBQztLQUNIO0lBRUQsTUFBTSxjQUFjLEdBQW1CLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUMxRCxhQUFhLENBQUMsZUFBZSxDQUM5QixDQUFDO0lBQ0YsTUFBTSw0QkFBNEIsR0FBRyxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUUzRCxJQUFJLENBQUMsNEJBQTRCLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFFO1FBQzFELE1BQU0sSUFBSSxLQUFLLENBQ2IsR0FDRSxhQUFhLENBQUMsZUFDaEIsaUNBQWlDLDRCQUE0QixDQUFDLElBQUksQ0FDaEUsSUFBSSxDQUNMLEdBQUcsQ0FDTCxDQUFDO0tBQ0g7SUFFRCxPQUFPO1FBQ0wsSUFBSSxFQUFFLGNBQWM7UUFDcEIsU0FBUyxFQUFFLGdCQUFnQjtRQUMzQixJQUFJLEVBQUUsV0FBVztLQUNsQixDQUFDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBDREtDb250ZXh0S2V5IH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHsgQmFja2VuZElkZW50aWZpZXIsIERlcGxveW1lbnRUeXBlIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsdWdpbi10eXBlcyc7XG5cbi8qKlxuICogUG9wdWxhdGVzIGEgYmFja2VuZCBpZGVudGlmaWVyIGJhc2VkIG9uIENESyBjb250ZXh0IHZhbHVlcy5cbiAqL1xuZXhwb3J0IGNvbnN0IGdldEJhY2tlbmRJZGVudGlmaWVyID0gKHNjb3BlOiBDb25zdHJ1Y3QpOiBCYWNrZW5kSWRlbnRpZmllciA9PiB7XG4gIGNvbnN0IGJhY2tlbmROYW1lc3BhY2UgPSBzY29wZS5ub2RlLmdldENvbnRleHQoXG4gICAgQ0RLQ29udGV4dEtleS5CQUNLRU5EX05BTUVTUEFDRVxuICApO1xuICBpZiAodHlwZW9mIGJhY2tlbmROYW1lc3BhY2UgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYCR7Q0RLQ29udGV4dEtleS5CQUNLRU5EX05BTUVTUEFDRX0gQ0RLIGNvbnRleHQgdmFsdWUgaXMgbm90IGEgc3RyaW5nYFxuICAgICk7XG4gIH1cblxuICBjb25zdCBiYWNrZW5kTmFtZSA9IHNjb3BlLm5vZGUuZ2V0Q29udGV4dChDREtDb250ZXh0S2V5LkJBQ0tFTkRfTkFNRSk7XG5cbiAgaWYgKHR5cGVvZiBiYWNrZW5kTmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgJHtDREtDb250ZXh0S2V5LkJBQ0tFTkRfTkFNRX0gQ0RLIGNvbnRleHQgdmFsdWUgaXMgbm90IGEgc3RyaW5nYFxuICAgICk7XG4gIH1cblxuICBjb25zdCBkZXBsb3ltZW50VHlwZTogRGVwbG95bWVudFR5cGUgPSBzY29wZS5ub2RlLmdldENvbnRleHQoXG4gICAgQ0RLQ29udGV4dEtleS5ERVBMT1lNRU5UX1RZUEVcbiAgKTtcbiAgY29uc3QgZXhwZWN0ZWREZXBsb3ltZW50VHlwZVZhbHVlcyA9IFsnc2FuZGJveCcsICdicmFuY2gnXTtcblxuICBpZiAoIWV4cGVjdGVkRGVwbG95bWVudFR5cGVWYWx1ZXMuaW5jbHVkZXMoZGVwbG95bWVudFR5cGUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYCR7XG4gICAgICAgIENES0NvbnRleHRLZXkuREVQTE9ZTUVOVF9UWVBFXG4gICAgICB9IENESyBjb250ZXh0IHZhbHVlIGlzIG5vdCBpbiAoJHtleHBlY3RlZERlcGxveW1lbnRUeXBlVmFsdWVzLmpvaW4oXG4gICAgICAgICcsICdcbiAgICAgICl9KWBcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBkZXBsb3ltZW50VHlwZSxcbiAgICBuYW1lc3BhY2U6IGJhY2tlbmROYW1lc3BhY2UsXG4gICAgbmFtZTogYmFja2VuZE5hbWUsXG4gIH07XG59O1xuIl19