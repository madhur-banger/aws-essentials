import { WriteStream } from 'node:tty';
import { EOL } from 'os';
/**
 * The class that pretty prints to the output stream.
 */
export class Printer {
    minimumLogLevel;
    stdout;
    stderr;
    refreshRate;
    // Properties for ellipsis animation
    timer;
    timerSet;
    /**
     * Spinner frames
     */
    spinnerFrames = ['⠋', '⠙', '⠹', '⠸', '⠼', '⠴', '⠦', '⠧', '⠇', '⠏'];
    /**
     * Sets default configs
     */
    constructor(minimumLogLevel, stdout = process.stdout, stderr = process.stderr, refreshRate = 500) {
        this.minimumLogLevel = minimumLogLevel;
        this.stdout = stdout;
        this.stderr = stderr;
        this.refreshRate = refreshRate;
    }
    /**
     * Prints a given message to output stream followed by a newline.
     */
    print = (message) => {
        this.stdout.write(message);
        this.printNewLine();
    };
    /**
     * Prints a new line to output stream
     */
    printNewLine = () => {
        this.stdout.write(EOL);
    };
    /**
     * Logs a message to the output stream at the given log level followed by a newline
     */
    log(message, level = LogLevel.INFO) {
        const doLogMessage = level <= this.minimumLogLevel;
        if (!doLogMessage) {
            return;
        }
        const logMessage = this.minimumLogLevel === LogLevel.DEBUG
            ? `[${LogLevel[level]}] ${new Date().toISOString()}: ${message}`
            : message;
        if (level === LogLevel.ERROR) {
            this.stderr.write(logMessage);
        }
        else {
            this.stdout.write(logMessage);
        }
        this.printNewLine();
    }
    /**
     * Logs a message with animated spinner
     * If stdout is not a TTY, the message is logged at the info level without a spinner
     */
    async indicateProgress(message, callback) {
        try {
            this.startAnimatingSpinner(message);
            await callback();
        }
        finally {
            this.stopAnimatingSpinner();
        }
    }
    /**
     * Writes escape sequence to stdout
     */
    writeEscapeSequence(action) {
        if (!this.isTTY()) {
            return;
        }
        this.stdout.write(action);
    }
    /**
     * Checks if the environment is TTY
     */
    isTTY() {
        return this.stdout instanceof WriteStream && this.stdout.isTTY;
    }
    /**
     * Starts animating spinner with a message.
     */
    startAnimatingSpinner(message) {
        if (this.timerSet) {
            throw new Error('Timer is already set to animate spinner, stop the current running timer before starting a new one.');
        }
        if (!this.isTTY()) {
            this.log(message, LogLevel.INFO);
            return;
        }
        let frameIndex = 0;
        this.timerSet = true;
        this.writeEscapeSequence(EscapeSequence.HIDE_CURSOR);
        this.timer = setInterval(() => {
            this.writeEscapeSequence(EscapeSequence.CLEAR_LINE);
            this.writeEscapeSequence(EscapeSequence.MOVE_CURSOR_TO_START);
            const frame = this.spinnerFrames[frameIndex];
            this.stdout.write(`${frame} ${message}`);
            frameIndex = (frameIndex + 1) % this.spinnerFrames.length;
        }, this.refreshRate);
    }
    /**
     * Stops animating spinner.
     */
    stopAnimatingSpinner() {
        if (!this.isTTY()) {
            return;
        }
        clearInterval(this.timer);
        this.timerSet = false;
        this.writeEscapeSequence(EscapeSequence.CLEAR_LINE);
        this.writeEscapeSequence(EscapeSequence.MOVE_CURSOR_TO_START);
        this.writeEscapeSequence(EscapeSequence.SHOW_CURSOR);
    }
}
export var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["ERROR"] = 0] = "ERROR";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["DEBUG"] = 2] = "DEBUG";
})(LogLevel || (LogLevel = {}));
var EscapeSequence;
(function (EscapeSequence) {
    EscapeSequence["CLEAR_LINE"] = "\u001B[2K";
    EscapeSequence["MOVE_CURSOR_TO_START"] = "\u001B[0G";
    EscapeSequence["SHOW_CURSOR"] = "\u001B[?25h";
    EscapeSequence["HIDE_CURSOR"] = "\u001B[?25l";
})(EscapeSequence || (EscapeSequence = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcmludGVyL3ByaW50ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN2QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBR3pCOztHQUVHO0FBQ0gsTUFBTSxPQUFPLE9BQU87SUFhQztJQUNBO0lBR0E7SUFHQTtJQW5CbkIsb0NBQW9DO0lBQzVCLEtBQUssQ0FBZ0M7SUFDckMsUUFBUSxDQUFVO0lBQzFCOztPQUVHO0lBQ0ssYUFBYSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFM0U7O09BRUc7SUFDSCxZQUNtQixlQUF5QixFQUN6QixTQUVXLE9BQU8sQ0FBQyxNQUFNLEVBQ3pCLFNBRVcsT0FBTyxDQUFDLE1BQU0sRUFDekIsY0FBc0IsR0FBRztRQVB6QixvQkFBZSxHQUFmLGVBQWUsQ0FBVTtRQUN6QixXQUFNLEdBQU4sTUFBTSxDQUVtQjtRQUN6QixXQUFNLEdBQU4sTUFBTSxDQUVtQjtRQUN6QixnQkFBVyxHQUFYLFdBQVcsQ0FBYztJQUN6QyxDQUFDO0lBRUo7O09BRUc7SUFDSCxLQUFLLEdBQUcsQ0FBQyxPQUFlLEVBQUUsRUFBRTtRQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDdEIsQ0FBQyxDQUFDO0lBRUY7O09BRUc7SUFDSCxZQUFZLEdBQUcsR0FBRyxFQUFFO1FBQ2xCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pCLENBQUMsQ0FBQztJQUVG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Q1I7UUFFRCxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdkQsQ0FBQztDQUNGO0FBRUQsTUFBTSxDQUFOLElBQVksUUFJWDtBQUpELFdBQVksUUFBUTtJQUNsQix5Q0FBUyxDQUFBO0lBQ1QsdUNBQVEsQ0FBQTtJQUNSLHlDQUFTLENBQUE7QUFDWCxDQUFDLEVBSlcsUUFBUSxLQUFSLFFBQVEsUUFJbkI7QUFFRCxJQUFLLGNBS0o7QUFMRCxXQUFLLGNBQWM7SUFDakIsMENBQXNCLENBQUE7SUFDdEIsb0RBQWdDLENBQUE7SUFDaEMsNkNBQXlCLENBQUE7SUFDekIsNkNBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQUxJLGNBQWMsS0FBZCxjQUFjLFFBS2xCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgV3JpdGVTdHJlYW0gfSBmcm9tICdub2RlOnR0eSc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5leHBvcnQgdHlwZSBSZWNvcmRWYWx1ZSA9IHN0cmluZyB8IG51bWJlciB8IHN0cmluZ1tdIHwgRGF0ZTtcblxuLyoqXG4gKiBUaGUgY2xhc3MgdGhhdCBwcmV0dHkgcHJpbnRzIHRvIHRoZSBvdXRwdXQgc3RyZWFtLlxuICovXG5leHBvcnQgY2xhc3MgUHJpbnRlciB7XG4gIC8vIFByb3BlcnRpZXMgZm9yIGVsbGlwc2lzIGFuaW1hdGlvblxuICBwcml2YXRlIHRpbWVyOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRUaW1lb3V0PjtcbiAgcHJpdmF0ZSB0aW1lclNldDogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFNwaW5uZXIgZnJhbWVzXG4gICAqL1xuICBwcml2YXRlIHNwaW5uZXJGcmFtZXMgPSBbJ+KgiycsICfioJknLCAn4qC5JywgJ+KguCcsICfioLwnLCAn4qC0JywgJ+KgpicsICfioKcnLCAn4qCHJywgJ+KgjyddO1xuXG4gIC8qKlxuICAgKiBTZXRzIGRlZmF1bHQgY29uZmlnc1xuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBtaW5pbXVtTG9nTGV2ZWw6IExvZ0xldmVsLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgc3Rkb3V0OlxuICAgICAgfCBXcml0ZVN0cmVhbVxuICAgICAgfCBOb2RlSlMuV3JpdGFibGVTdHJlYW0gPSBwcm9jZXNzLnN0ZG91dCxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHN0ZGVycjpcbiAgICAgIHwgV3JpdGVTdHJlYW1cbiAgICAgIHwgTm9kZUpTLldyaXRhYmxlU3RyZWFtID0gcHJvY2Vzcy5zdGRlcnIsXG4gICAgcHJpdmF0ZSByZWFkb25seSByZWZyZXNoUmF0ZTogbnVtYmVyID0gNTAwXG4gICkge31cblxuICAvKipcbiAgICogUHJpbnRzIGEgZ2l2ZW4gbWVzc2FnZSB0byBvdXRwdXQgc3RyZWFtIGZvbGxvd2VkIGJ5IGEgbmV3bGluZS5cbiAgICovXG4gIHByaW50ID0gKG1lc3NhZ2U6IHN0cmluZykgPT4ge1xuICAgIHRoaXMuc3Rkb3V0LndyaXRlKG1lc3NhZ2UpO1xuICAgIHRoaXMucHJpbnROZXdMaW5lKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByaW50cyBhIG5ldyBsaW5lIHRvIG91dHB1dCBzdHJlYW1cbiAgICovXG4gIHByaW50TmV3TGluZSA9ICgpID0+IHtcbiAgICB0aGlzLnN0ZG91dC53cml0ZShFT0wpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBMb2dzIGEgbWVzc2FnZSB0byB0aGUgb3V0cHV0IHN0cmVhbSBhdCB0aGUgZ2l2ZW4gbG9nIGxldmVsIGZvbGxvd2VkIGJ5IGEgbmV3bGluZVxuICAgKi9cbiAgbG9nKG1lc3NhZ2U6IHN0cmluZywgbGV2ZWw6IExvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTykge1xuICAgIGNvbnN0IGRvTG9nTWVzc2FnZSA9IGxldmVsIDw9IHRoaXMubWluaW11bUxvZ0xldmVsO1xuXG4gICAgaWYgKCFkb0xvZ01lc3NhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsb2dNZXNzYWdlID1cbiAgICAgIHRoaXMubWluaW11bUxvZ0xldmVsID09PSBMb2dMZXZlbC5ERUJVR1xuICAgICAgICA/IGBbJHtMb2dMZXZlbFtsZXZlbF19XSAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX06ICR7bWVzc2FnZX1gXG4gICAgICAgIDogbWVzc2FnZTtcblxuICAgIGlmIChsZXZlbCA9PT0gTG9nTGV2ZWwuRVJST1IpIHtcbiAgICAgIHRoaXMuc3RkZXJyLndyaXRlKGxvZ01lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0ZG91dC53cml0ZShsb2dNZXNzYWdlKTtcbiAgICB9XG5cbiAgICB0aGlzLnByaW50TmV3TGluZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZ3MgYSBtZXNzYWdlIHdpdGggYW5pbWF0ZWQgc3Bpbm5lclxuICAgKiBJZiBzdGRvdXQgaXMgbm90IGEgVFRZLCB0aGUgbWVzc2FnZSBpcyBsb2dnZWQgYXQgdGhlIGluZm8gbGV2ZWwgd2l0aG91dCBhIHNwaW5uZXJcbiAgICovXG4gIGFzeW5jIGluZGljYXRlUHJvZ3Jlc3MobWVzc2FnZTogc3RyaW5nLCBjYWxsYmFjazogKCkgPT4gUHJvbWlzZTx2b2lkPikge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnN0YXJ0QW5pbWF0aW5nU3Bpbm5lcihtZXNzYWdlKTtcbiAgICAgIGF3YWl0IGNhbGxiYWNrKCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuc3RvcEFuaW1hdGluZ1NwaW5uZXIoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV3JpdGVzIGVzY2FwZSBzZXF1ZW5jZSB0byBzdGRvdXRcbiAgICovXG4gIHByaXZhdGUgd3JpdGVFc2NhcGVTZXF1ZW5jZShhY3Rpb246IEVzY2FwZVNlcXVlbmNlKSB7XG4gICAgaWYgKCF0aGlzLmlzVFRZKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnN0ZG91dC53cml0ZShhY3Rpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgZW52aXJvbm1lbnQgaXMgVFRZXG4gICAqL1xuICBwcml2YXRlIGlzVFRZKCkge1xuICAgIHJldHVybiB0aGlzLnN0ZG91dCBpbnN0YW5jZW9mIFdyaXRlU3RyZWFtICYmIHRoaXMuc3Rkb3V0LmlzVFRZO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0cyBhbmltYXRpbmcgc3Bpbm5lciB3aXRoIGEgbWVzc2FnZS5cbiAgICovXG4gIHByaXZhdGUgc3RhcnRBbmltYXRpbmdTcGlubmVyKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnRpbWVyU2V0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUaW1lciBpcyBhbHJlYWR5IHNldCB0byBhbmltYXRlIHNwaW5uZXIsIHN0b3AgdGhlIGN1cnJlbnQgcnVubmluZyB0aW1lciBiZWZvcmUgc3RhcnRpbmcgYSBuZXcgb25lLidcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmlzVFRZKCkpIHtcbiAgICAgIHRoaXMubG9nKG1lc3NhZ2UsIExvZ0xldmVsLklORk8pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBmcmFtZUluZGV4ID0gMDtcbiAgICB0aGlzLnRpbWVyU2V0ID0gdHJ1ZTtcbiAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuSElERV9DVVJTT1IpO1xuICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuQ0xFQVJfTElORSk7XG4gICAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuTU9WRV9DVVJTT1JfVE9fU1RBUlQpO1xuICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLnNwaW5uZXJGcmFtZXNbZnJhbWVJbmRleF07XG4gICAgICB0aGlzLnN0ZG91dC53cml0ZShgJHtmcmFtZX0gJHttZXNzYWdlfWApO1xuICAgICAgZnJhbWVJbmRleCA9IChmcmFtZUluZGV4ICsgMSkgJSB0aGlzLnNwaW5uZXJGcmFtZXMubGVuZ3RoO1xuICAgIH0sIHRoaXMucmVmcmVzaFJhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3BzIGFuaW1hdGluZyBzcGlubmVyLlxuICAgKi9cbiAgcHJpdmF0ZSBzdG9wQW5pbWF0aW5nU3Bpbm5lcigpIHtcbiAgICBpZiAoIXRoaXMuaXNUVFkoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcik7XG4gICAgdGhpcy50aW1lclNldCA9IGZhbHNlO1xuICAgIHRoaXMud3JpdGVFc2NhcGVTZXF1ZW5jZShFc2NhcGVTZXF1ZW5jZS5DTEVBUl9MSU5FKTtcbiAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuTU9WRV9DVVJTT1JfVE9fU1RBUlQpO1xuICAgIHRoaXMud3JpdGVFc2NhcGVTZXF1ZW5jZShFc2NhcGVTZXF1ZW5jZS5TSE9XX0NVUlNPUik7XG4gIH1cbn1cblxuZXhwb3J0IGVudW0gTG9nTGV2ZWwge1xuICBFUlJPUiA9IDAsXG4gIElORk8gPSAxLFxuICBERUJVRyA9IDIsXG59XG5cbmVudW0gRXNjYXBlU2VxdWVuY2Uge1xuICBDTEVBUl9MSU5FID0gJ1xceDFiWzJLJyxcbiAgTU9WRV9DVVJTT1JfVE9fU1RBUlQgPSAnXFx4MWJbMEcnLFxuICBTSE9XX0NVUlNPUiA9ICdcXHgxYls/MjVoJyxcbiAgSElERV9DVVJTT1IgPSAnXFx4MWJbPzI1bCcsXG59XG4iXX0=