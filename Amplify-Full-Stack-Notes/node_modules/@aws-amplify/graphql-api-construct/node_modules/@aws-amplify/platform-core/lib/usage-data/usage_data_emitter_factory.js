"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsageDataEmitterFactory = void 0;
const local_configuration_controller_factory_js_1 = require("../config/local_configuration_controller_factory.js");
const noop_usage_data_emitter_js_1 = require("./noop_usage_data_emitter.js");
const usage_data_emitter_js_1 = require("./usage_data_emitter.js");
const constants_js_1 = require("./constants.js");
/**
 * Creates UsageDataEmitter for a given library version
 */
class UsageDataEmitterFactory {
    /**
     * Creates UsageDataEmitter for a given library version, usage data tracking preferences
     */
    getInstance = async (libraryVersion) => {
        const configController = local_configuration_controller_factory_js_1.configControllerFactory.getInstance('usage_data_preferences.json');
        const usageDataTrackingDisabledLocalFile = (await configController.get(constants_js_1.USAGE_DATA_TRACKING_ENABLED)) ===
            false;
        if (process.env.AMPLIFY_DISABLE_TELEMETRY ||
            usageDataTrackingDisabledLocalFile) {
            return new noop_usage_data_emitter_js_1.NoOpUsageDataEmitter();
        }
        return new usage_data_emitter_js_1.DefaultUsageDataEmitter(libraryVersion);
    };
}
exports.UsageDataEmitterFactory = UsageDataEmitterFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNhZ2VfZGF0YV9lbWl0dGVyX2ZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNhZ2UtZGF0YS91c2FnZV9kYXRhX2VtaXR0ZXJfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtSEFBOEY7QUFDOUYsNkVBQW9FO0FBQ3BFLG1FQUFrRTtBQUNsRSxpREFBNkQ7QUFjN0Q7O0dBRUc7QUFDSCxNQUFhLHVCQUF1QjtJQUNsQzs7T0FFRztJQUNILFdBQVcsR0FBRyxLQUFLLEVBQUUsY0FBc0IsRUFBNkIsRUFBRTtRQUN4RSxNQUFNLGdCQUFnQixHQUFHLG1FQUF1QixDQUFDLFdBQVcsQ0FDMUQsNkJBQTZCLENBQzlCLENBQUM7UUFFRixNQUFNLGtDQUFrQyxHQUN0QyxDQUFDLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFVLDBDQUEyQixDQUFDLENBQUM7WUFDbEUsS0FBSyxDQUFDO1FBRVIsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QjtZQUNyQyxrQ0FBa0MsRUFDbEM7WUFDQSxPQUFPLElBQUksaURBQW9CLEVBQUUsQ0FBQztTQUNuQztRQUNELE9BQU8sSUFBSSwrQ0FBdUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNyRCxDQUFDLENBQUM7Q0FDSDtBQXJCRCwwREFxQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25maWdDb250cm9sbGVyRmFjdG9yeSB9IGZyb20gJy4uL2NvbmZpZy9sb2NhbF9jb25maWd1cmF0aW9uX2NvbnRyb2xsZXJfZmFjdG9yeS5qcyc7XG5pbXBvcnQgeyBOb09wVXNhZ2VEYXRhRW1pdHRlciB9IGZyb20gJy4vbm9vcF91c2FnZV9kYXRhX2VtaXR0ZXIuanMnO1xuaW1wb3J0IHsgRGVmYXVsdFVzYWdlRGF0YUVtaXR0ZXIgfSBmcm9tICcuL3VzYWdlX2RhdGFfZW1pdHRlci5qcyc7XG5pbXBvcnQgeyBVU0FHRV9EQVRBX1RSQUNLSU5HX0VOQUJMRUQgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBBbXBsaWZ5RXJyb3IgfSBmcm9tICcuLi9pbmRleC5qcyc7XG5cbmV4cG9ydCB0eXBlIFVzYWdlRGF0YUVtaXR0ZXIgPSB7XG4gIGVtaXRTdWNjZXNzOiAoXG4gICAgbWV0cmljcz86IFJlY29yZDxzdHJpbmcsIG51bWJlcj4sXG4gICAgZGltZW5zaW9ucz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbiAgKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBlbWl0RmFpbHVyZTogKFxuICAgIGVycm9yOiBBbXBsaWZ5RXJyb3IsXG4gICAgZGltZW5zaW9ucz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbiAgKSA9PiBQcm9taXNlPHZvaWQ+O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIFVzYWdlRGF0YUVtaXR0ZXIgZm9yIGEgZ2l2ZW4gbGlicmFyeSB2ZXJzaW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBVc2FnZURhdGFFbWl0dGVyRmFjdG9yeSB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIFVzYWdlRGF0YUVtaXR0ZXIgZm9yIGEgZ2l2ZW4gbGlicmFyeSB2ZXJzaW9uLCB1c2FnZSBkYXRhIHRyYWNraW5nIHByZWZlcmVuY2VzXG4gICAqL1xuICBnZXRJbnN0YW5jZSA9IGFzeW5jIChsaWJyYXJ5VmVyc2lvbjogc3RyaW5nKTogUHJvbWlzZTxVc2FnZURhdGFFbWl0dGVyPiA9PiB7XG4gICAgY29uc3QgY29uZmlnQ29udHJvbGxlciA9IGNvbmZpZ0NvbnRyb2xsZXJGYWN0b3J5LmdldEluc3RhbmNlKFxuICAgICAgJ3VzYWdlX2RhdGFfcHJlZmVyZW5jZXMuanNvbidcbiAgICApO1xuXG4gICAgY29uc3QgdXNhZ2VEYXRhVHJhY2tpbmdEaXNhYmxlZExvY2FsRmlsZSA9XG4gICAgICAoYXdhaXQgY29uZmlnQ29udHJvbGxlci5nZXQ8Ym9vbGVhbj4oVVNBR0VfREFUQV9UUkFDS0lOR19FTkFCTEVEKSkgPT09XG4gICAgICBmYWxzZTtcblxuICAgIGlmIChcbiAgICAgIHByb2Nlc3MuZW52LkFNUExJRllfRElTQUJMRV9URUxFTUVUUlkgfHxcbiAgICAgIHVzYWdlRGF0YVRyYWNraW5nRGlzYWJsZWRMb2NhbEZpbGVcbiAgICApIHtcbiAgICAgIHJldHVybiBuZXcgTm9PcFVzYWdlRGF0YUVtaXR0ZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBEZWZhdWx0VXNhZ2VEYXRhRW1pdHRlcihsaWJyYXJ5VmVyc2lvbik7XG4gIH07XG59XG4iXX0=