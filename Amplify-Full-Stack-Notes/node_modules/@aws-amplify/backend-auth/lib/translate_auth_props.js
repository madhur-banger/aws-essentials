/**
 * Translate an Auth factory's loginWith to its Auth construct counterpart. Backend secret fields will be resolved
 * to an CFN token and map to the required construct type. Note that not all construct secret fields are of sdk
 * SecretValue type, many are (wrongly) of type string as well.
 */
export const translateToAuthConstructLoginWith = (authFactoryLoginWith, backendSecretResolver) => {
    const result = authFactoryLoginWith;
    if (!authFactoryLoginWith.externalProviders) {
        return result;
    }
    const externalProviders = authFactoryLoginWith.externalProviders;
    result.externalProviders = {
        ...externalProviders,
    };
    const amazonProps = translateAmazonProps(backendSecretResolver, externalProviders.loginWithAmazon);
    if (amazonProps) {
        result.externalProviders.loginWithAmazon = amazonProps;
    }
    const appleProps = translateAppleProps(backendSecretResolver, externalProviders.signInWithApple);
    if (appleProps) {
        result.externalProviders.signInWithApple = appleProps;
    }
    const facebookProps = translateFacebookProps(backendSecretResolver, externalProviders.facebook);
    if (facebookProps) {
        result.externalProviders.facebook = facebookProps;
    }
    const oidcProps = translateOidcProps(backendSecretResolver, externalProviders.oidc);
    if (oidcProps) {
        result.externalProviders.oidc = oidcProps;
    }
    const googleProps = translateGoogleProps(backendSecretResolver, externalProviders.google);
    if (googleProps) {
        result.externalProviders.google = googleProps;
    }
    return result;
};
const translateAmazonProps = (backendSecretResolver, amazonProviderProps) => {
    if (!amazonProviderProps) {
        return undefined;
    }
    const { clientId, clientSecret, ...noSecretProps } = amazonProviderProps;
    return {
        ...noSecretProps,
        clientId: backendSecretResolver.resolveSecret(clientId).unsafeUnwrap(),
        clientSecret: backendSecretResolver
            .resolveSecret(clientSecret)
            .unsafeUnwrap(),
    };
};
const translateAppleProps = (backendSecretResolver, amazonProviderProps) => {
    if (!amazonProviderProps) {
        return undefined;
    }
    const { clientId, teamId, keyId, privateKey, ...noSecretProps } = amazonProviderProps;
    return {
        ...noSecretProps,
        clientId: backendSecretResolver.resolveSecret(clientId).unsafeUnwrap(),
        teamId: backendSecretResolver.resolveSecret(teamId).unsafeUnwrap(),
        keyId: backendSecretResolver.resolveSecret(keyId).unsafeUnwrap(),
        privateKey: backendSecretResolver.resolveSecret(privateKey).unsafeUnwrap(),
    };
};
const translateFacebookProps = (backendSecretResolver, facebookProviderProps) => {
    if (!facebookProviderProps) {
        return undefined;
    }
    const { clientId, clientSecret, ...noSecretProps } = facebookProviderProps;
    return {
        ...noSecretProps,
        clientId: backendSecretResolver.resolveSecret(clientId).unsafeUnwrap(),
        clientSecret: backendSecretResolver
            .resolveSecret(clientSecret)
            .unsafeUnwrap(),
    };
};
const translateOidcProps = (backendSecretResolver, oidcProviderProps) => {
    if (!oidcProviderProps || oidcProviderProps.length === 0) {
        return undefined;
    }
    const result = [];
    for (const provider of oidcProviderProps) {
        const { clientId, clientSecret, ...noSecretProps } = provider;
        result.push({
            ...noSecretProps,
            clientId: backendSecretResolver.resolveSecret(clientId).unsafeUnwrap(),
            clientSecret: backendSecretResolver
                .resolveSecret(clientSecret)
                .unsafeUnwrap(),
        });
    }
    return result;
};
const translateGoogleProps = (backendSecretResolver, googleProviderProps) => {
    if (!googleProviderProps) {
        return undefined;
    }
    const { clientId, clientSecret: clientSecretValue, ...noSecretProps } = googleProviderProps;
    return {
        ...noSecretProps,
        clientId: backendSecretResolver.resolveSecret(clientId).unsafeUnwrap(),
        clientSecret: backendSecretResolver.resolveSecret(clientSecretValue),
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRlX2F1dGhfcHJvcHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdHJhbnNsYXRlX2F1dGhfcHJvcHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBbUJBOzs7O0dBSUc7QUFDSCxNQUFNLENBQUMsTUFBTSxpQ0FBaUMsR0FBRyxDQUMvQyxvQkFBK0MsRUFDL0MscUJBQTRDLEVBQ3BCLEVBQUU7SUFDMUIsTUFBTSxNQUFNLEdBQ1Ysb0JBQThDLENBQUM7SUFDakQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGlCQUFpQixFQUFFO1FBQzNDLE9BQU8sTUFBTSxDQUFDO0tBQ2Y7SUFFRCxNQUFNLGlCQUFpQixHQUFHLG9CQUFvQixDQUFDLGlCQUFpQixDQUFDO0lBQ2pFLE1BQU0sQ0FBQyxpQkFBaUIsR0FBRztRQUN6QixHQUFJLGlCQUF5RDtLQUM5RCxDQUFDO0lBRUYsTUFBTSxXQUFXLEdBQUcsb0JBQW9CLENBQ3RDLHFCQUFxQixFQUNyQixpQkFBaUIsQ0FBQyxlQUFlLENBQ2xDLENBQUM7SUFDRixJQUFJLFdBQVcsRUFBRTtRQUNmLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLEdBQUcsV0FBVyxDQUFDO0tBQ3hEO0lBRUQsTUFBTSxVQUFVLEdBQUcsbUJBQW1CLENBQ3BDLHFCQUFxQixFQUNyQixpQkFBaUIsQ0FBQyxlQUFlLENBQ2xDLENBQUM7SUFDRixJQUFJLFVBQVUsRUFBRTtRQUNkLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLEdBQUcsVUFBVSxDQUFDO0tBQ3ZEO0lBRUQsTUFBTSxhQUFhLEdBQUcsc0JBQXNCLENBQzFDLHFCQUFxQixFQUNyQixpQkFBaUIsQ0FBQyxRQUFRLENBQzNCLENBQUM7SUFDRixJQUFJLGFBQWEsRUFBRTtRQUNqQixNQUFNLENBQUMsaUJBQWlCLENBQUMsUUFBUSxHQUFHLGFBQWEsQ0FBQztLQUNuRDtJQUVELE1BQU0sU0FBUyxHQUFHLGtCQUFrQixDQUNsQyxxQkFBcUIsRUFD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QU0sQ0FBQyxJQUFJLENBQUM7WUFDVixHQUFHLGFBQWE7WUFDaEIsUUFBUSxFQUFFLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLEVBQUU7WUFDdEUsWUFBWSxFQUFFLHFCQUFxQjtpQkFDaEMsYUFBYSxDQUFDLFlBQVksQ0FBQztpQkFDM0IsWUFBWSxFQUFFO1NBQ2xCLENBQUMsQ0FBQztLQUNKO0lBRUQsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxvQkFBb0IsR0FBRyxDQUMzQixxQkFBNEMsRUFDNUMsbUJBQWdELEVBQ2YsRUFBRTtJQUNuQyxJQUFJLENBQUMsbUJBQW1CLEVBQUU7UUFDeEIsT0FBTyxTQUFTLENBQUM7S0FDbEI7SUFFRCxNQUFNLEVBQ0osUUFBUSxFQUNSLFlBQVksRUFBRSxpQkFBaUIsRUFDL0IsR0FBRyxhQUFhLEVBQ2pCLEdBQUcsbUJBQW1CLENBQUM7SUFDeEIsT0FBTztRQUNMLEdBQUcsYUFBYTtRQUNoQixRQUFRLEVBQUUscUJBQXFCLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksRUFBRTtRQUN0RSxZQUFZLEVBQUUscUJBQXFCLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDO0tBQ3JFLENBQUM7QUFDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBbWF6b25Qcm92aWRlclByb3BzLFxuICBBcHBsZVByb3ZpZGVyUHJvcHMsXG4gIEF1dGhQcm9wcyxcbiAgRmFjZWJvb2tQcm92aWRlclByb3BzLFxuICBHb29nbGVQcm92aWRlclByb3BzLFxuICBPaWRjUHJvdmlkZXJQcm9wcyxcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L2F1dGgtY29uc3RydWN0JztcbmltcG9ydCB7IEJhY2tlbmRTZWNyZXRSZXNvbHZlciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuaW1wb3J0IHtcbiAgQW1hem9uUHJvdmlkZXJGYWN0b3J5UHJvcHMsXG4gIEFwcGxlUHJvdmlkZXJGYWN0b3J5UHJvcHMsXG4gIEF1dGhMb2dpbldpdGhGYWN0b3J5UHJvcHMsXG4gIEV4dGVybmFsUHJvdmlkZXJHZW5lcmFsRmFjdG9yeVByb3BzLFxuICBGYWNlYm9va1Byb3ZpZGVyRmFjdG9yeVByb3BzLFxuICBHb29nbGVQcm92aWRlckZhY3RvcnlQcm9wcyxcbiAgT2lkY1Byb3ZpZGVyRmFjdG9yeVByb3BzLFxufSBmcm9tICcuL3R5cGVzLmpzJztcblxuLyoqXG4gKiBUcmFuc2xhdGUgYW4gQXV0aCBmYWN0b3J5J3MgbG9naW5XaXRoIHRvIGl0cyBBdXRoIGNvbnN0cnVjdCBjb3VudGVycGFydC4gQmFja2VuZCBzZWNyZXQgZmllbGRzIHdpbGwgYmUgcmVzb2x2ZWRcbiAqIHRvIGFuIENGTiB0b2tlbiBhbmQgbWFwIHRvIHRoZSByZXF1aXJlZCBjb25zdHJ1Y3QgdHlwZS4gTm90ZSB0aGF0IG5vdCBhbGwgY29uc3RydWN0IHNlY3JldCBmaWVsZHMgYXJlIG9mIHNka1xuICogU2VjcmV0VmFsdWUgdHlwZSwgbWFueSBhcmUgKHdyb25nbHkpIG9mIHR5cGUgc3RyaW5nIGFzIHdlbGwuXG4gKi9cbmV4cG9ydCBjb25zdCB0cmFuc2xhdGVUb0F1dGhDb25zdHJ1Y3RMb2dpbldpdGggPSAoXG4gIGF1dGhGYWN0b3J5TG9naW5XaXRoOiBBdXRoTG9naW5XaXRoRmFjdG9yeVByb3BzLFxuICBiYWNrZW5kU2VjcmV0UmVzb2x2ZXI6IEJhY2tlbmRTZWNyZXRSZXNvbHZlclxuKTogQXV0aFByb3BzWydsb2dpbldpdGgnXSA9PiB7XG4gIGNvbnN0IHJlc3VsdDogQXV0aFByb3BzWydsb2dpbldpdGgnXSA9XG4gICAgYXV0aEZhY3RvcnlMb2dpbldpdGggYXMgQXV0aFByb3BzWydsb2dpbldpdGgnXTtcbiAgaWYgKCFhdXRoRmFjdG9yeUxvZ2luV2l0aC5leHRlcm5hbFByb3ZpZGVycykge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBjb25zdCBleHRlcm5hbFByb3ZpZGVycyA9IGF1dGhGYWN0b3J5TG9naW5XaXRoLmV4dGVybmFsUHJvdmlkZXJzO1xuICByZXN1bHQuZXh0ZXJuYWxQcm92aWRlcnMgPSB7XG4gICAgLi4uKGV4dGVybmFsUHJvdmlkZXJzIGFzIEV4dGVybmFsUHJvdmlkZXJHZW5lcmFsRmFjdG9yeVByb3BzKSxcbiAgfTtcblxuICBjb25zdCBhbWF6b25Qcm9wcyA9IHRyYW5zbGF0ZUFtYXpvblByb3BzKFxuICAgIGJhY2tlbmRTZWNyZXRSZXNvbHZlcixcbiAgICBleHRlcm5hbFByb3ZpZGVycy5sb2dpbldpdGhBbWF6b25cbiAgKTtcbiAgaWYgKGFtYXpvblByb3BzKSB7XG4gICAgcmVzdWx0LmV4dGVybmFsUHJvdmlkZXJzLmxvZ2luV2l0aEFtYXpvbiA9IGFtYXpvblByb3BzO1xuICB9XG5cbiAgY29uc3QgYXBwbGVQcm9wcyA9IHRyYW5zbGF0ZUFwcGxlUHJvcHMoXG4gICAgYmFja2VuZFNlY3JldFJlc29sdmVyLFxuICAgIGV4dGVybmFsUHJvdmlkZXJzLnNpZ25JbldpdGhBcHBsZVxuICApO1xuICBpZiAoYXBwbGVQcm9wcykge1xuICAgIHJlc3VsdC5leHRlcm5hbFByb3ZpZGVycy5zaWduSW5XaXRoQXBwbGUgPSBhcHBsZVByb3BzO1xuICB9XG5cbiAgY29uc3QgZmFjZWJvb2tQcm9wcyA9IHRyYW5zbGF0ZUZhY2Vib29rUHJvcHMoXG4gICAgYmFja2VuZFNlY3JldFJlc29sdmVyLFxuICAgIGV4dGVybmFsUHJvdmlkZXJzLmZhY2Vib29rXG4gICk7XG4gIGlmIChmYWNlYm9va1Byb3BzKSB7XG4gICAgcmVzdWx0LmV4dGVybmFsUHJvdmlkZXJzLmZhY2Vib29rID0gZmFjZWJvb2tQcm9wcztcbiAgfVxuXG4gIGNvbnN0IG9pZGNQcm9wcyA9IHRyYW5zbGF0ZU9pZGNQcm9wcyhcbiAgICBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIsXG4gICAgZXh0ZXJuYWxQcm92aWRlcnMub2lkY1xuICApO1xuICBpZiAob2lkY1Byb3BzKSB7XG4gICAgcmVzdWx0LmV4dGVybmFsUHJvdmlkZXJzLm9pZGMgPSBvaWRjUHJvcHM7XG4gIH1cblxuICBjb25zdCBnb29nbGVQcm9wcyA9IHRyYW5zbGF0ZUdvb2dsZVByb3BzKFxuICAgIGJhY2tlbmRTZWNyZXRSZXNvbHZlcixcbiAgICBleHRlcm5hbFByb3ZpZGVycy5nb29nbGVcbiAgKTtcbiAgaWYgKGdvb2dsZVByb3BzKSB7XG4gICAgcmVzdWx0LmV4dGVybmFsUHJvdmlkZXJzLmdvb2dsZSA9IGdvb2dsZVByb3BzO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmNvbnN0IHRyYW5zbGF0ZUFtYXpvblByb3BzID0gKFxuICBiYWNrZW5kU2VjcmV0UmVzb2x2ZXI6IEJhY2tlbmRTZWNyZXRSZXNvbHZlcixcbiAgYW1hem9uUHJvdmlkZXJQcm9wcz86IEFtYXpvblByb3ZpZGVyRmFjdG9yeVByb3BzXG4pOiBBbWF6b25Qcm92aWRlclByb3BzIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKCFhbWF6b25Qcm92aWRlclByb3BzKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbnN0IHsgY2xpZW50SWQsIGNsaWVudFNlY3JldCwgLi4ubm9TZWNyZXRQcm9wcyB9ID0gYW1hem9uUHJvdmlkZXJQcm9wcztcbiAgcmV0dXJuIHtcbiAgICAuLi5ub1NlY3JldFByb3BzLFxuICAgIGNsaWVudElkOiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIucmVzb2x2ZVNlY3JldChjbGllbnRJZCkudW5zYWZlVW53cmFwKCksXG4gICAgY2xpZW50U2VjcmV0OiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXJcbiAgICAgIC5yZXNvbHZlU2VjcmV0KGNsaWVudFNlY3JldClcbiAgICAgIC51bnNhZmVVbndyYXAoKSxcbiAgfTtcbn07XG5cbmNvbnN0IHRyYW5zbGF0ZUFwcGxlUHJvcHMgPSAoXG4gIGJhY2tlbmRTZWNyZXRSZXNvbHZlcjogQmFja2VuZFNlY3JldFJlc29sdmVyLFxuICBhbWF6b25Qcm92aWRlclByb3BzPzogQXBwbGVQcm92aWRlckZhY3RvcnlQcm9wc1xuKTogQXBwbGVQcm92aWRlclByb3BzIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKCFhbWF6b25Qcm92aWRlclByb3BzKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbnN0IHsgY2xpZW50SWQsIHRlYW1JZCwga2V5SWQsIHByaXZhdGVLZXksIC4uLm5vU2VjcmV0UHJvcHMgfSA9XG4gICAgYW1hem9uUHJvdmlkZXJQcm9wcztcbiAgcmV0dXJuIHtcbiAgICAuLi5ub1NlY3JldFByb3BzLFxuICAgIGNsaWVudElkOiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIucmVzb2x2ZVNlY3JldChjbGllbnRJZCkudW5zYWZlVW53cmFwKCksXG4gICAgdGVhbUlkOiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIucmVzb2x2ZVNlY3JldCh0ZWFtSWQpLnVuc2FmZVVud3JhcCgpLFxuICAgIGtleUlkOiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIucmVzb2x2ZVNlY3JldChrZXlJZCkudW5zYWZlVW53cmFwKCksXG4gICAgcHJpdmF0ZUtleTogYmFja2VuZFNlY3JldFJlc29sdmVyLnJlc29sdmVTZWNyZXQocHJpdmF0ZUtleSkudW5zYWZlVW53cmFwKCksXG4gIH07XG59O1xuXG5jb25zdCB0cmFuc2xhdGVGYWNlYm9va1Byb3BzID0gKFxuICBiYWNrZW5kU2VjcmV0UmVzb2x2ZXI6IEJhY2tlbmRTZWNyZXRSZXNvbHZlcixcbiAgZmFjZWJvb2tQcm92aWRlclByb3BzPzogRmFjZWJvb2tQcm92aWRlckZhY3RvcnlQcm9wc1xuKTogRmFjZWJvb2tQcm92aWRlclByb3BzIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKCFmYWNlYm9va1Byb3ZpZGVyUHJvcHMpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3QgeyBjbGllbnRJZCwgY2xpZW50U2VjcmV0LCAuLi5ub1NlY3JldFByb3BzIH0gPSBmYWNlYm9va1Byb3ZpZGVyUHJvcHM7XG4gIHJldHVybiB7XG4gICAgLi4ubm9TZWNyZXRQcm9wcyxcbiAgICBjbGllbnRJZDogYmFja2VuZFNlY3JldFJlc29sdmVyLnJlc29sdmVTZWNyZXQoY2xpZW50SWQpLnVuc2FmZVVud3JhcCgpLFxuICAgIGNsaWVudFNlY3JldDogYmFja2VuZFNlY3JldFJlc29sdmVyXG4gICAgICAucmVzb2x2ZVNlY3JldChjbGllbnRTZWNyZXQpXG4gICAgICAudW5zYWZlVW53cmFwKCksXG4gIH07XG59O1xuXG5jb25zdCB0cmFuc2xhdGVPaWRjUHJvcHMgPSAoXG4gIGJhY2tlbmRTZWNyZXRSZXNvbHZlcjogQmFja2VuZFNlY3JldFJlc29sdmVyLFxuICBvaWRjUHJvdmlkZXJQcm9wcz86IE9pZGNQcm92aWRlckZhY3RvcnlQcm9wc1tdXG4pOiBPaWRjUHJvdmlkZXJQcm9wc1tdIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKCFvaWRjUHJvdmlkZXJQcm9wcyB8fCBvaWRjUHJvdmlkZXJQcm9wcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgcHJvdmlkZXIgb2Ygb2lkY1Byb3ZpZGVyUHJvcHMpIHtcbiAgICBjb25zdCB7IGNsaWVudElkLCBjbGllbnRTZWNyZXQsIC4uLm5vU2VjcmV0UHJvcHMgfSA9IHByb3ZpZGVyO1xuICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgIC4uLm5vU2VjcmV0UHJvcHMsXG4gICAgICBjbGllbnRJZDogYmFja2VuZFNlY3JldFJlc29sdmVyLnJlc29sdmVTZWNyZXQoY2xpZW50SWQpLnVuc2FmZVVud3JhcCgpLFxuICAgICAgY2xpZW50U2VjcmV0OiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXJcbiAgICAgICAgLnJlc29sdmVTZWNyZXQoY2xpZW50U2VjcmV0KVxuICAgICAgICAudW5zYWZlVW53cmFwKCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuY29uc3QgdHJhbnNsYXRlR29vZ2xlUHJvcHMgPSAoXG4gIGJhY2tlbmRTZWNyZXRSZXNvbHZlcjogQmFja2VuZFNlY3JldFJlc29sdmVyLFxuICBnb29nbGVQcm92aWRlclByb3BzPzogR29vZ2xlUHJvdmlkZXJGYWN0b3J5UHJvcHNcbik6IEdvb2dsZVByb3ZpZGVyUHJvcHMgfCB1bmRlZmluZWQgPT4ge1xuICBpZiAoIWdvb2dsZVByb3ZpZGVyUHJvcHMpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3Qge1xuICAgIGNsaWVudElkLFxuICAgIGNsaWVudFNlY3JldDogY2xpZW50U2VjcmV0VmFsdWUsXG4gICAgLi4ubm9TZWNyZXRQcm9wc1xuICB9ID0gZ29vZ2xlUHJvdmlkZXJQcm9wcztcbiAgcmV0dXJuIHtcbiAgICAuLi5ub1NlY3JldFByb3BzLFxuICAgIGNsaWVudElkOiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIucmVzb2x2ZVNlY3JldChjbGllbnRJZCkudW5zYWZlVW53cmFwKCksXG4gICAgY2xpZW50U2VjcmV0OiBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIucmVzb2x2ZVNlY3JldChjbGllbnRTZWNyZXRWYWx1ZSksXG4gIH07XG59O1xuIl19