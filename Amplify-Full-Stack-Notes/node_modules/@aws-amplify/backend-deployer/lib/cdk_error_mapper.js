import { AmplifyError, AmplifyFault, AmplifyUserError, } from '@aws-amplify/platform-core';
/**
 * Transforms CDK error messages to human readable ones
 */
export class CdkErrorMapper {
    formatter;
    multiLineEolRegex = '[\r\n]+';
    /**
     * Instantiate with a formatter that will be used for formatting CLI commands in error messages
     */
    constructor(formatter) {
        this.formatter = formatter;
    }
    getAmplifyError = (error) => {
        let underlyingError = error;
        // Check if there was an Amplify error thrown during child process execution
        const amplifyError = AmplifyError.fromStderr(error.message);
        if (amplifyError) {
            return amplifyError;
        }
        const matchingError = this.getKnownErrors().find((knownError) => knownError.errorRegex.test(error.message));
        if (matchingError) {
            // Extract meaningful contextual information if available
            const matchGroups = error.message.match(matchingError.errorRegex);
            if (matchGroups && matchGroups.length > 1) {
                // If the contextual information can be used in the error message use it, else consider it as a downstream cause
                if (matchGroups.groups) {
                    for (const [key, value] of Object.entries(matchGroups.groups)) {
                        const placeHolder = `{${key}}`;
                        if (matchingError.humanReadableErrorMessage.includes(placeHolder)) {
                            matchingError.humanReadableErrorMessage =
                                matchingError.humanReadableErrorMessage.replace(placeHolder, value);
                            // reset the stderr dump in the underlying error
                            underlyingError = undefined;
                        }
                    }
                    // remove any trailing EOL
                    matchingError.humanReadableErrorMessage =
                        matchingError.humanReadableErrorMessage.replace(new RegExp(`${this.multiLineEolRegex}$`), '');
                }
                else {
                    underlyingError.message = matchGroups[0];
                }
            }
            return matchingError.classification === 'ERROR'
                ? new AmplifyUserError(matchingError.errorName, {
                    message: matchingError.humanReadableErrorMessage,
                    resolution: matchingError.resolutionMessage,
                }, underlyingError)
                : new AmplifyFault(matchingError.errorName, {
                    message: matchingError.humanReadableErrorMessage,
                    resolution: matchingError.resolutionMessage,
                }, underlyingError);
        }
        return AmplifyError.fromError(error);
    };
    getKnownErrors = () => [
        {
            errorRegex: /ExpiredToken/,
            humanReadableErrorMessage: 'The security token included in the request is invalid.',
            resolutionMessage: 'Ensure your local AWS credentials are valid.',
            errorName: 'ExpiredTokenError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Access Denied/,
            humanReadableErrorMessage: 'The deployment role does not have sufficient permissions to perform this deployment.',
            resolutionMessage: 'Ensure your deployment role has the AmplifyBackendDeployFullAccess role along with any additional permissions required to deploy your backend definition.',
            errorName: 'AccessDeniedError',
            classification: 'ERROR',
        },
        {
            errorRegex: /(Has the environment been bootstrapped)|(Is account \d+ bootstrapped)|(Is this account bootstrapped)/,
            humanReadableErrorMessage: 'This AWS account and region has not been bootstrapped.',
            resolutionMessage: 'Run `cdk bootstrap aws://{YOUR_ACCOUNT_ID}/{YOUR_REGION}` locally to resolve this.',
            errorName: 'BootstrapNotDetectedError',
            classification: 'ERROR',
        },
        {
            errorRegex: /This CDK CLI is not compatible with the CDK library used by your application\. Please upgrade the CLI to the latest version\./,
            humanReadableErrorMessage: "Installed 'aws-cdk' is not compatible with installed 'aws-cdk-lib'.",
            resolutionMessage: "Make sure that version of 'aws-cdk' is greater or equal to version of 'aws-cdk-lib'",
            errorName: 'CDKVersionMismatchError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`(SyntaxError|ReferenceError|TypeError)( \\[[A-Z_]+])?:((?:.|${this.multiLineEolRegex})*?at .*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'SyntaxError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Unable to resolve AWS account to use/,
            humanReadableErrorMessage: 'Unable to resolve AWS account to use. It must be either configured when you define your CDK Stack, or through the environment',
            resolutionMessage: 'You can retry your last request as this is most likely a transient issue: https://github.com/aws/aws-cdk/issues/24744. If the error persists ensure your local AWS credentials are valid.',
            errorName: 'CDKResolveAWSAccountError',
            classification: 'ERROR',
        },
        {
            errorRegex: /EACCES(.*)/,
            humanReadableErrorMessage: 'File permissions error',
            resolutionMessage: 'Check that you have the right access permissions to the mentioned file',
            errorName: 'FilePermissionsError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`\\[ERR_MODULE_NOT_FOUND\\]:(.*)${this.multiLineEolRegex}|Error: Cannot find module (.*)`),
            humanReadableErrorMessage: 'Cannot find module',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for missing file or package imports. Try installing them with your package manager.',
            errorName: 'ModuleNotFoundError',
            classification: 'ERROR',
        },
        {
            // Truncate the cdk error message's second line (Invoke the CLI in sequence, or use '--output' to synth into different directories.)
            errorRegex: /Another CLI (.*) is currently(.*)\. |Other CLIs (.*) are currently reading from(.*)\. /,
            humanReadableErrorMessage: 'Multiple sandbox instances detected.',
            resolutionMessage: 'Make sure only one instance of sandbox is running for this project',
            errorName: 'MultipleSandboxInstancesError',
            classification: 'ERROR',
        },
        {
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`\\[esbuild Error\\]: ((?:.|${this.multiLineEolRegex})*?at .*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`[âœ˜X] \\[ERROR\\] ((?:.|${this.multiLineEolRegex})*error.*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            // If there are multiple errors, capture all lines containing the errors
            errorRegex: new RegExp(`\\[TransformError\\]: Transform failed with .* error(s?):${this.multiLineEolRegex}(?<esBuildErrorMessage>(.*ERROR:.*${this.multiLineEolRegex})+)`),
            humanReadableErrorMessage: '{esBuildErrorMessage}',
            resolutionMessage: 'Fix the above mentioned type or syntax error in your backend definition.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Amplify Backend not found in/,
            humanReadableErrorMessage: 'Backend definition could not be found in amplify directory.',
            resolutionMessage: 'Ensure that the amplify/backend.(ts|js) file exists',
            errorName: 'FileConventionError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Amplify (.*) must be defined in (.*)/,
            humanReadableErrorMessage: 'File name or path for backend definition are incorrect.',
            resolutionMessage: 'Ensure that the amplify/backend.(ts|js) file exists',
            errorName: 'FileConventionError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Updates are not allowed for property/,
            humanReadableErrorMessage: 'The changes that you are trying to apply are not supported.',
            resolutionMessage: 'The resources referenced in the error message must be deleted and recreated to apply the changes.',
            errorName: 'CFNUpdateNotSupportedError',
            classification: 'ERROR',
        },
        {
            // This error originates from Cognito service when user tries to change UserPool attributes which is not allowed
            // https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html
            // Remapping to `UpdateNotSupported` will allow sandbox to prompt users for resetting their environment
            errorRegex: /Invalid AttributeDataType input, consider using the provided AttributeDataType enum/,
            humanReadableErrorMessage: 'User pool attributes cannot be changed after a user pool has been created.',
            resolutionMessage: 'To change these attributes, remove `defineAuth` from your backend, deploy, then add it back. Note that removing `defineAuth` and deploying will delete any users stored in your UserPool.',
            errorName: 'CFNUpdateNotSupportedError',
            classification: 'ERROR',
        },
        {
            // Error: .* is printed to stderr during cdk synth
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`^Error: (.*${this.multiLineEolRegex}.*at.*)`, 'm'),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'BackendSynthError',
            classification: 'ERROR',
        },
        {
            // "Catch all": the backend entry point file is referenced in the stack indicating a problem in customer code
            errorRegex: /amplify\/backend/,
            humanReadableErrorMessage: 'Unable to build Amplify backend.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'BackendBuildError',
            classification: 'ERROR',
        },
        {
            // We capture the parameter name to show relevant error message
            errorRegex: /Failed to retrieve backend secret (?<secretName>.*) for.*ParameterNotFound/,
            humanReadableErrorMessage: `The secret {secretName} specified in the backend does not exist.`,
            resolutionMessage: `Create secrets using the command ${this.formatter.normalizeAmpxCommand('sandbox secret set')}. For more information, see https://docs.amplify.aws/gen2/deploy-and-host/sandbox-environments/features/#set-secrets`,
            errorName: 'SecretNotSetError',
            classification: 'ERROR',
        },
        {
            // Note that the order matters, this should be the last as it captures generic CFN error
            errorRegex: new RegExp(`Deployment failed: (.*)${this.multiLineEolRegex}|The stack named (.*) failed (to deploy:|creation,) (.*)`),
            humanReadableErrorMessage: 'The CloudFormation deployment has failed.',
            resolutionMessage: 'Find more information in the CloudFormation AWS Console for this stack.',
            errorName: 'CloudFormationDeploymentError',
            classification: 'ERROR',
        },
    ];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrX2Vycm9yX21hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jZGtfZXJyb3JfbWFwcGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxZQUFZLEVBRVosWUFBWSxFQUNaLGdCQUFnQixHQUNqQixNQUFNLDRCQUE0QixDQUFDO0FBR3BDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGNBQWM7SUFLSTtJQUpyQixpQkFBaUIsR0FBRyxTQUFTLENBQUM7SUFDdEM7O09BRUc7SUFDSCxZQUE2QixTQUF5QztRQUF6QyxjQUFTLEdBQVQsU0FBUyxDQUFnQztJQUFHLENBQUM7SUFFMUUsZUFBZSxHQUFHLENBQ2hCLEtBQVksRUFDK0IsRUFBRTtRQUM3QyxJQUFJLGVBQWUsR0FBc0IsS0FBSyxDQUFDO1FBRS9DLDRFQUE0RTtRQUM1RSxNQUFNLFlBQVksR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1RCxJQUFJLFlBQVksRUFBRTtZQUNoQixPQUFPLFlBQVksQ0FBQztTQUNyQjtRQUVELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUM5RCxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQzFDLENBQUM7UUFFRixJQUFJLGFBQWEsRUFBRTtZQUNqQix5REFBeUQ7WUFDekQsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRWxFLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUN6QyxnSEFBZ0g7Z0JBQ2hILElBQUksV0FBVyxDQUFDLE1BQU0sRUFBRTtvQkFDdEIsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUss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WUFDckYsU0FBUyxFQUFFLG1CQUFtQjtZQUM5QixjQUFjLEVBQUUsT0FBTztTQUN4QjtRQUNEO1lBQ0UsK0RBQStEO1lBQy9ELFVBQVUsRUFDUiw0RUFBNEU7WUFDOUUseUJBQXlCLEVBQUUsa0VBQWtFO1lBQzdGLGlCQUFpQixFQUFFLG9DQUFvQyxJQUFJLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUN4RixvQkFBb0IsQ0FDckIsc0hBQXNIO1lBQ3ZILFNBQVMsRUFBRSxtQkFBbUI7WUFDOUIsY0FBYyxFQUFFLE9BQU87U0FDeEI7UUFDRDtZQUNFLHdGQUF3RjtZQUN4RixVQUFVLEVBQUUsSUFBSSxNQUFNLENBQ3BCLDBCQUEwQixJQUFJLENBQUMsaUJBQWlCLDBEQUEwRCxDQUMzRztZQUNELHlCQUF5QixFQUFFLDJDQUEyQztZQUN0RSxpQkFBaUIsRUFDZix5RUFBeUU7WUFDM0UsU0FBUyxFQUFFLCtCQUErQjtZQUMxQyxjQUFjLEVBQUUsT0FBTztTQUN4QjtLQUNGLENBQUM7Q0FDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFtcGxpZnlFcnJvcixcbiAgQW1wbGlmeUVycm9yQ2xhc3NpZmljYXRpb24sXG4gIEFtcGxpZnlGYXVsdCxcbiAgQW1wbGlmeVVzZXJFcnJvcixcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHsgQmFja2VuZERlcGxveWVyT3V0cHV0Rm9ybWF0dGVyIH0gZnJvbSAnLi90eXBlcy5qcyc7XG5cbi8qKlxuICogVHJhbnNmb3JtcyBDREsgZXJyb3IgbWVzc2FnZXMgdG8gaHVtYW4gcmVhZGFibGUgb25lc1xuICovXG5leHBvcnQgY2xhc3MgQ2RrRXJyb3JNYXBwZXIge1xuICBwcml2YXRlIG11bHRpTGluZUVvbFJlZ2V4ID0gJ1tcXHJcXG5dKyc7XG4gIC8qKlxuICAgKiBJbnN0YW50aWF0ZSB3aXRoIGEgZm9ybWF0dGVyIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBmb3JtYXR0aW5nIENMSSBjb21tYW5kcyBpbiBlcnJvciBtZXNzYWdlc1xuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBmb3JtYXR0ZXI6IEJhY2tlbmREZXBsb3llck91dHB1dEZvcm1hdHRlcikge31cblxuICBnZXRBbXBsaWZ5RXJyb3IgPSAoXG4gICAgZXJyb3I6IEVycm9yXG4gICk6IEFtcGxpZnlFcnJvcjxDREtEZXBsb3ltZW50RXJyb3IgfCBzdHJpbmc+ID0+IHtcbiAgICBsZXQgdW5kZXJseWluZ0Vycm9yOiBFcnJvciB8IHVuZGVmaW5lZCA9IGVycm9yO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgd2FzIGFuIEFtcGxpZnkgZXJyb3IgdGhyb3duIGR1cmluZyBjaGlsZCBwcm9jZXNzIGV4ZWN1dGlvblxuICAgIGNvbnN0IGFtcGxpZnlFcnJvciA9IEFtcGxpZnlFcnJvci5mcm9tU3RkZXJyKGVycm9yLm1lc3NhZ2UpO1xuICAgIGlmIChhbXBsaWZ5RXJyb3IpIHtcbiAgICAgIHJldHVybiBhbXBsaWZ5RXJyb3I7XG4gICAgfVxuXG4gICAgY29uc3QgbWF0Y2hpbmdFcnJvciA9IHRoaXMuZ2V0S25vd25FcnJvcnMoKS5maW5kKChrbm93bkVycm9yKSA9PlxuICAgICAga25vd25FcnJvci5lcnJvclJlZ2V4LnRlc3QoZXJyb3IubWVzc2FnZSlcbiAgICApO1xuXG4gICAgaWYgKG1hdGNoaW5nRXJyb3IpIHtcbiAgICAgIC8vIEV4dHJhY3QgbWVhbmluZ2Z1bCBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGlmIGF2YWlsYWJsZVxuICAgICAgY29uc3QgbWF0Y2hHcm91cHMgPSBlcnJvci5tZXNzYWdlLm1hdGNoKG1hdGNoaW5nRXJyb3IuZXJyb3JSZWdleCk7XG5cbiAgICAgIGlmIChtYXRjaEdyb3VwcyAmJiBtYXRjaEdyb3Vwcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIC8vIElmIHRoZSBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGluIHRoZSBlcnJvciBtZXNzYWdlIHVzZSBpdCwgZWxzZSBjb25zaWRlciBpdCBhcyBhIGRvd25zdHJlYW0gY2F1c2VcbiAgICAgICAgaWYgKG1hdGNoR3JvdXBzLmdyb3Vwcykge1xuICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG1hdGNoR3JvdXBzLmdyb3VwcykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBsYWNlSG9sZGVyID0gYHske2tleX19YDtcbiAgICAgICAgICAgIGlmIChtYXRjaGluZ0Vycm9yLmh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2UuaW5jbHVkZXMocGxhY2VIb2xkZXIpKSB7XG4gICAgICAgICAgICAgIG1hdGNoaW5nRXJyb3IuaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgICAgICAgbWF0Y2hpbmdFcnJvci5odW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICBwbGFjZUhvbGRlcixcbiAgICAgICAgICAgICAgICAgIHZhbHVlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgLy8gcmVzZXQgdGhlIHN0ZGVyciBkdW1wIGluIHRoZSB1bmRlcmx5aW5nIGVycm9yXG4gICAgICAgICAgICAgIHVuZGVybHlpbmdFcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gcmVtb3ZlIGFueSB0cmFpbGluZyBFT0xcbiAgICAgICAgICBtYXRjaGluZ0Vycm9yLmh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2UgPVxuICAgICAgICAgICAgbWF0Y2hpbmdFcnJvci5odW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlLnJlcGxhY2UoXG4gICAgICAgICAgICAgIG5ldyBSZWdFeHAoYCR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH0kYCksXG4gICAgICAgICAgICAgICcnXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVuZGVybHlpbmdFcnJvci5tZXNzYWdlID0gbWF0Y2hHcm91cHNbMF07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1hdGNoaW5nRXJyb3IuY2xhc3NpZmljYXRpb24gPT09ICdFUlJPUidcbiAgICAgICAgPyBuZXcgQW1wbGlmeVVzZXJFcnJvcihcbiAgICAgICAgICAgIG1hdGNoaW5nRXJyb3IuZXJyb3JOYW1lLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtZXNzYWdlOiBtYXRjaGluZ0Vycm9yLmh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2UsXG4gICAgICAgICAgICAgIHJlc29sdXRpb246IG1hdGNoaW5nRXJyb3IucmVzb2x1dGlvbk1lc3NhZ2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5kZXJseWluZ0Vycm9yXG4gICAgICAgICAgKVxuICAgICAgICA6IG5ldyBBbXBsaWZ5RmF1bHQoXG4gICAgICAgICAgICBtYXRjaGluZ0Vycm9yLmVycm9yTmFtZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogbWF0Y2hpbmdFcnJvci5odW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlLFxuICAgICAgICAgICAgICByZXNvbHV0aW9uOiBtYXRjaGluZ0Vycm9yLnJlc29sdXRpb25NZXNzYWdlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVuZGVybHlpbmdFcnJvclxuICAgICAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBBbXBsaWZ5RXJyb3IuZnJvbUVycm9yKGVycm9yKTtcbiAgfTtcblxuICBwcml2YXRlIGdldEtub3duRXJyb3JzID0gKCk6IEFycmF5PHtcbiAgICBlcnJvclJlZ2V4OiBSZWdFeHA7XG4gICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogc3RyaW5nO1xuICAgIHJlc29sdXRpb25NZXNzYWdlOiBzdHJpbmc7XG4gICAgZXJyb3JOYW1lOiBDREtEZXBsb3ltZW50RXJyb3I7XG4gICAgY2xhc3NpZmljYXRpb246IEFtcGxpZnlFcnJvckNsYXNzaWZpY2F0aW9uO1xuICB9PiA9PiBbXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogL0V4cGlyZWRUb2tlbi8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVGhlIHNlY3VyaXR5IHRva2VuIGluY2x1ZGVkIGluIHRoZSByZXF1ZXN0IGlzIGludmFsaWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOiAnRW5zdXJlIHlvdXIgbG9jYWwgQVdTIGNyZWRlbnRpYWxzIGFyZSB2YWxpZC4nLFxuICAgICAgZXJyb3JOYW1lOiAnRXhwaXJlZFRva2VuRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OiAvQWNjZXNzIERlbmllZC8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVGhlIGRlcGxveW1lbnQgcm9sZSBkb2VzIG5vdCBoYXZlIHN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gcGVyZm9ybSB0aGlzIGRlcGxveW1lbnQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnRW5zdXJlIHlvdXIgZGVwbG95bWVudCByb2xlIGhhcyB0aGUgQW1wbGlmeUJhY2tlbmREZXBsb3lGdWxsQWNjZXNzIHJvbGUgYWxvbmcgd2l0aCBhbnkgYWRkaXRpb25hbCBwZXJtaXNzaW9ucyByZXF1aXJlZCB0byBkZXBsb3kgeW91ciBiYWNrZW5kIGRlZmluaXRpb24uJyxcbiAgICAgIGVycm9yTmFtZTogJ0FjY2Vzc0RlbmllZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDpcbiAgICAgICAgLyhIYXMgdGhlIGVudmlyb25tZW50IGJlZW4gYm9vdHN0cmFwcGVkKXwoSXMgYWNjb3VudCBcXGQrIGJvb3RzdHJhcHBlZCl8KElzIHRoaXMgYWNjb3VudCBib290c3RyYXBwZWQpLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdUaGlzIEFXUyBhY2NvdW50IGFuZCByZWdpb24gaGFzIG5vdCBiZWVuIGJvb3RzdHJhcHBlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdSdW4gYGNkayBib290c3RyYXAgYXdzOi8ve1lPVVJfQUNDT1VOVF9JRH0ve1lPVVJfUkVHSU9OfWAgbG9jYWxseSB0byByZXNvbHZlIHRoaXMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0Jvb3RzdHJhcE5vdERldGVjdGVkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvVGhpcyBDREsgQ0xJIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggdGhlIENESyBsaWJyYXJ5IHVzZWQgYnkgeW91ciBhcHBsaWNhdGlvblxcLiBQbGVhc2UgdXBncmFkZSB0aGUgQ0xJIHRvIHRoZSBsYXRlc3QgdmVyc2lvblxcLi8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICBcIkluc3RhbGxlZCAnYXdzLWNkaycgaXMgbm90IGNvbXBhdGlibGUgd2l0aCBpbnN0YWxsZWQgJ2F3cy1jZGstbGliJy5cIixcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICBcIk1ha2Ugc3VyZSB0aGF0IHZlcnNpb24gb2YgJ2F3cy1jZGsnIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdmVyc2lvbiBvZiAnYXdzLWNkay1saWInXCIsXG4gICAgICBlcnJvck5hbWU6ICdDREtWZXJzaW9uTWlzbWF0Y2hFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGAoU3ludGF4RXJyb3J8UmVmZXJlbmNlRXJyb3J8VHlwZUVycm9yKSggXFxcXFtbQS1aX10rXSk/OigoPzoufCR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH0pKj9hdCAuKilgXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VuYWJsZSB0byBidWlsZCB0aGUgQW1wbGlmeSBiYWNrZW5kIGRlZmluaXRpb24uJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgeW91ciBiYWNrZW5kIGRlZmluaXRpb24gaW4gdGhlIGBhbXBsaWZ5YCBmb2xkZXIgZm9yIHN5bnRheCBhbmQgdHlwZSBlcnJvcnMuJyxcbiAgICAgIGVycm9yTmFtZTogJ1N5bnRheEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogL1VuYWJsZSB0byByZXNvbHZlIEFXUyBhY2NvdW50IHRvIHVzZS8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVW5hYmxlIHRvIHJlc29sdmUgQVdTIGFjY291bnQgdG8gdXNlLiBJdCBtdXN0IGJlIGVpdGhlciBjb25maWd1cmVkIHdoZW4geW91IGRlZmluZSB5b3VyIENESyBTdGFjaywgb3IgdGhyb3VnaCB0aGUgZW52aXJvbm1lbnQnLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdZb3UgY2FuIHJldHJ5IHlvdXIgbGFzdCByZXF1ZXN0IGFzIHRoaXMgaXMgbW9zdCBsaWtlbHkgYSB0cmFuc2llbnQgaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9hd3MvYXdzLWNkay9pc3N1ZXMvMjQ3NDQuIElmIHRoZSBlcnJvciBwZXJzaXN0cyBlbnN1cmUgeW91ciBsb2NhbCBBV1MgY3JlZGVudGlhbHMgYXJlIHZhbGlkLicsXG4gICAgICBlcnJvck5hbWU6ICdDREtSZXNvbHZlQVdTQWNjb3VudEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogL0VBQ0NFUyguKikvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ0ZpbGUgcGVybWlzc2lvbnMgZXJyb3InLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdDaGVjayB0aGF0IHlvdSBoYXZlIHRoZSByaWdodCBhY2Nlc3MgcGVybWlzc2lvbnMgdG8gdGhlIG1lbnRpb25lZCBmaWxlJyxcbiAgICAgIGVycm9yTmFtZTogJ0ZpbGVQZXJtaXNzaW9uc0Vycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogbmV3IFJlZ0V4cChcbiAgICAgICAgYFxcXFxbRVJSX01PRFVMRV9OT1RfRk9VTkRcXFxcXTooLiopJHt0aGlzLm11bHRpTGluZUVvbFJlZ2V4fXxFcnJvcjogQ2Fubm90IGZpbmQgbW9kdWxlICguKilgXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ0Nhbm5vdCBmaW5kIG1vZHVsZScsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBtaXNzaW5nIGZpbGUgb3IgcGFja2FnZSBpbXBvcnRzLiBUcnkgaW5zdGFsbGluZyB0aGVtIHdpdGggeW91ciBwYWNrYWdlIG1hbmFnZXIuJyxcbiAgICAgIGVycm9yTmFtZTogJ01vZHVsZU5vdEZvdW5kRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBUcnVuY2F0ZSB0aGUgY2RrIGVycm9yIG1lc3NhZ2UncyBzZWNvbmQgbGluZSAoSW52b2tlIHRoZSBDTEkgaW4gc2VxdWVuY2UsIG9yIHVzZSAnLS1vdXRwdXQnIHRvIHN5bnRoIGludG8gZGlmZmVyZW50IGRpcmVjdG9yaWVzLilcbiAgICAgIGVycm9yUmVnZXg6XG4gICAgICAgIC9Bbm90aGVyIENMSSAoLiopIGlzIGN1cnJlbnRseSguKilcXC4gfE90aGVyIENMSXMgKC4qKSBhcmUgY3VycmVudGx5IHJlYWRpbmcgZnJvbSguKilcXC4gLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdNdWx0aXBsZSBzYW5kYm94IGluc3RhbmNlcyBkZXRlY3RlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdNYWtlIHN1cmUgb25seSBvbmUgaW5zdGFuY2Ugb2Ygc2FuZGJveCBpcyBydW5uaW5nIGZvciB0aGlzIHByb2plY3QnLFxuICAgICAgZXJyb3JOYW1lOiAnTXVsdGlwbGVTYW5kYm94SW5zdGFuY2VzRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBBbHNvIGV4dHJhY3RzIHRoZSBmaXJzdCBsaW5lIGluIHRoZSBzdGFjayB3aGVyZSB0aGUgZXJyb3IgaGFwcGVuZWRcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGBcXFxcW2VzYnVpbGQgRXJyb3JcXFxcXTogKCg/Oi58JHt0aGlzLm11bHRpTGluZUVvbFJlZ2V4fSkqP2F0IC4qKWBcbiAgICAgICksXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVW5hYmxlIHRvIGJ1aWxkIHRoZSBBbXBsaWZ5IGJhY2tlbmQgZGVmaW5pdGlvbi4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdDaGVjayB5b3VyIGJhY2tlbmQgZGVmaW5pdGlvbiBpbiB0aGUgYGFtcGxpZnlgIGZvbGRlciBmb3Igc3ludGF4IGFuZCB0eXBlIGVycm9ycy4nLFxuICAgICAgZXJyb3JOYW1lOiAnRVNCdWlsZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gQWxzbyBleHRyYWN0cyB0aGUgZmlyc3QgbGluZSBpbiB0aGUgc3RhY2sgd2hlcmUgdGhlIGVycm9yIGhhcHBlbmVkXG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgW+KcmFhdIFxcXFxbRVJST1JcXFxcXSAoKD86Lnwke3RoaXMubXVsdGlMaW5lRW9sUmVnZXh9KSplcnJvci4qKWBcbiAgICAgICksXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVW5hYmxlIHRvIGJ1aWxkIHRoZSBBbXBsaWZ5IGJhY2tlbmQgZGVmaW5pdGlvbi4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdDaGVjayB5b3VyIGJhY2tlbmQgZGVmaW5pdGlvbiBpbiB0aGUgYGFtcGxpZnlgIGZvbGRlciBmb3Igc3ludGF4IGFuZCB0eXBlIGVycm9ycy4nLFxuICAgICAgZXJyb3JOYW1lOiAnRVNCdWlsZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gSWYgdGhlcmUgYXJlIG11bHRpcGxlIGVycm9ycywgY2FwdHVyZSBhbGwgbGluZXMgY29udGFpbmluZyB0aGUgZXJyb3JzXG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgXFxcXFtUcmFuc2Zvcm1FcnJvclxcXFxdOiBUcmFuc2Zvcm0gZmFpbGVkIHdpdGggLiogZXJyb3Iocz8pOiR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH0oPzxlc0J1aWxkRXJyb3JNZXNzYWdlPiguKkVSUk9SOi4qJHt0aGlzLm11bHRpTGluZUVvbFJlZ2V4fSkrKWBcbiAgICAgICksXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOiAne2VzQnVpbGRFcnJvck1lc3NhZ2V9JyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnRml4IHRoZSBhYm92ZSBtZW50aW9uZWQgdHlwZSBvciBzeW50YXggZXJyb3IgaW4geW91ciBiYWNrZW5kIGRlZmluaXRpb24uJyxcbiAgICAgIGVycm9yTmFtZTogJ0VTQnVpbGRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9BbXBsaWZ5IEJhY2tlbmQgbm90IGZvdW5kIGluLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdCYWNrZW5kIGRlZmluaXRpb24gY291bGQgbm90IGJlIGZvdW5kIGluIGFtcGxpZnkgZGlyZWN0b3J5LicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTogJ0Vuc3VyZSB0aGF0IHRoZSBhbXBsaWZ5L2JhY2tlbmQuKHRzfGpzKSBmaWxlIGV4aXN0cycsXG4gICAgICBlcnJvck5hbWU6ICdGaWxlQ29udmVudGlvbkVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogL0FtcGxpZnkgKC4qKSBtdXN0IGJlIGRlZmluZWQgaW4gKC4qKS8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnRmlsZSBuYW1lIG9yIHBhdGggZm9yIGJhY2tlbmQgZGVmaW5pdGlvbiBhcmUgaW5jb3JyZWN0LicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTogJ0Vuc3VyZSB0aGF0IHRoZSBhbXBsaWZ5L2JhY2tlbmQuKHRzfGpzKSBmaWxlIGV4aXN0cycsXG4gICAgICBlcnJvck5hbWU6ICdGaWxlQ29udmVudGlvbkVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogL1VwZGF0ZXMgYXJlIG5vdCBhbGxvd2VkIGZvciBwcm9wZXJ0eS8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVGhlIGNoYW5nZXMgdGhhdCB5b3UgYXJlIHRyeWluZyB0byBhcHBseSBhcmUgbm90IHN1cHBvcnRlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdUaGUgcmVzb3VyY2VzIHJlZmVyZW5jZWQgaW4gdGhlIGVycm9yIG1lc3NhZ2UgbXVzdCBiZSBkZWxldGVkIGFuZCByZWNyZWF0ZWQgdG8gYXBwbHkgdGhlIGNoYW5nZXMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0NGTlVwZGF0ZU5vdFN1cHBvcnRlZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gVGhpcyBlcnJvciBvcmlnaW5hdGVzIGZyb20gQ29nbml0byBzZXJ2aWNlIHdoZW4gdXNlciB0cmllcyB0byBjaGFuZ2UgVXNlclBvb2wgYXR0cmlidXRlcyB3aGljaCBpcyBub3QgYWxsb3dlZFxuICAgICAgLy8gaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZ25pdG8vbGF0ZXN0L2RldmVsb3Blcmd1aWRlL3VzZXItcG9vbC1zZXR0aW5ncy1hdHRyaWJ1dGVzLmh0bWxcbiAgICAgIC8vIFJlbWFwcGluZyB0byBgVXBkYXRlTm90U3VwcG9ydGVkYCB3aWxsIGFsbG93IHNhbmRib3ggdG8gcHJvbXB0IHVzZXJzIGZvciByZXNldHRpbmcgdGhlaXIgZW52aXJvbm1lbnRcbiAgICAgIGVycm9yUmVnZXg6XG4gICAgICAgIC9JbnZhbGlkIEF0dHJpYnV0ZURhdGFUeXBlIGlucHV0LCBjb25zaWRlciB1c2luZyB0aGUgcHJvdmlkZWQgQXR0cmlidXRlRGF0YVR5cGUgZW51bS8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnVXNlciBwb29sIGF0dHJpYnV0ZXMgY2Fubm90IGJlIGNoYW5nZWQgYWZ0ZXIgYSB1c2VyIHBvb2wgaGFzIGJlZW4gY3JlYXRlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdUbyBjaGFuZ2UgdGhlc2UgYXR0cmlidXRlcywgcmVtb3ZlIGBkZWZpbmVBdXRoYCBmcm9tIHlvdXIgYmFja2VuZCwgZGVwbG95LCB0aGVuIGFkZCBpdCBiYWNrLiBOb3RlIHRoYXQgcmVtb3ZpbmcgYGRlZmluZUF1dGhgIGFuZCBkZXBsb3lpbmcgd2lsbCBkZWxldGUgYW55IHVzZXJzIHN0b3JlZCBpbiB5b3VyIFVzZXJQb29sLicsXG4gICAgICBlcnJvck5hbWU6ICdDRk5VcGRhdGVOb3RTdXBwb3J0ZWRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIEVycm9yOiAuKiBpcyBwcmludGVkIHRvIHN0ZGVyciBkdXJpbmcgY2RrIHN5bnRoXG4gICAgICAvLyBBbHNvIGV4dHJhY3RzIHRoZSBmaXJzdCBsaW5lIGluIHRoZSBzdGFjayB3aGVyZSB0aGUgZXJyb3IgaGFwcGVuZWRcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGBeRXJyb3I6ICguKiR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH0uKmF0LiopYCxcbiAgICAgICAgJ20nXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VuYWJsZSB0byBidWlsZCB0aGUgQW1wbGlmeSBiYWNrZW5kIGRlZmluaXRpb24uJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgeW91ciBiYWNrZW5kIGRlZmluaXRpb24gaW4gdGhlIGBhbXBsaWZ5YCBmb2xkZXIgZm9yIHN5bnRheCBhbmQgdHlwZSBlcnJvcnMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0JhY2tlbmRTeW50aEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gXCJDYXRjaCBhbGxcIjogdGhlIGJhY2tlbmQgZW50cnkgcG9pbnQgZmlsZSBpcyByZWZlcmVuY2VkIGluIHRoZSBzdGFjayBpbmRpY2F0aW5nIGEgcHJvYmxlbSBpbiBjdXN0b21lciBjb2RlXG4gICAgICBlcnJvclJlZ2V4OiAvYW1wbGlmeVxcL2JhY2tlbmQvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ1VuYWJsZSB0byBidWlsZCBBbXBsaWZ5IGJhY2tlbmQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgeW91ciBiYWNrZW5kIGRlZmluaXRpb24gaW4gdGhlIGBhbXBsaWZ5YCBmb2xkZXIgZm9yIHN5bnRheCBhbmQgdHlwZSBlcnJvcnMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0JhY2tlbmRCdWlsZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gV2UgY2FwdHVyZSB0aGUgcGFyYW1ldGVyIG5hbWUgdG8gc2hvdyByZWxldmFudCBlcnJvciBtZXNzYWdlXG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvRmFpbGVkIHRvIHJldHJpZXZlIGJhY2tlbmQgc2VjcmV0ICg/PHNlY3JldE5hbWU+LiopIGZvci4qUGFyYW1ldGVyTm90Rm91bmQvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogYFRoZSBzZWNyZXQge3NlY3JldE5hbWV9IHNwZWNpZmllZCBpbiB0aGUgYmFja2VuZCBkb2VzIG5vdCBleGlzdC5gLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6IGBDcmVhdGUgc2VjcmV0cyB1c2luZyB0aGUgY29tbWFuZCAke3RoaXMuZm9ybWF0dGVyLm5vcm1hbGl6ZUFtcHhDb21tYW5kKFxuICAgICAgICAnc2FuZGJveCBzZWNyZXQgc2V0J1xuICAgICAgKX0uIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUgaHR0cHM6Ly9kb2NzLmFtcGxpZnkuYXdzL2dlbjIvZGVwbG95LWFuZC1ob3N0L3NhbmRib3gtZW52aXJvbm1lbnRzL2ZlYXR1cmVzLyNzZXQtc2VjcmV0c2AsXG4gICAgICBlcnJvck5hbWU6ICdTZWNyZXROb3RTZXRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIE5vdGUgdGhhdCB0aGUgb3JkZXIgbWF0dGVycywgdGhpcyBzaG91bGQgYmUgdGhlIGxhc3QgYXMgaXQgY2FwdHVyZXMgZ2VuZXJpYyBDRk4gZXJyb3JcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGBEZXBsb3ltZW50IGZhaWxlZDogKC4qKSR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH18VGhlIHN0YWNrIG5hbWVkICguKikgZmFpbGVkICh0byBkZXBsb3k6fGNyZWF0aW9uLCkgKC4qKWBcbiAgICAgICksXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOiAnVGhlIENsb3VkRm9ybWF0aW9uIGRlcGxveW1lbnQgaGFzIGZhaWxlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdGaW5kIG1vcmUgaW5mb3JtYXRpb24gaW4gdGhlIENsb3VkRm9ybWF0aW9uIEFXUyBDb25zb2xlIGZvciB0aGlzIHN0YWNrLicsXG4gICAgICBlcnJvck5hbWU6ICdDbG91ZEZvcm1hdGlvbkRlcGxveW1lbnRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICBdO1xufVxuXG5leHBvcnQgdHlwZSBDREtEZXBsb3ltZW50RXJyb3IgPVxuICB8ICdBY2Nlc3NEZW5pZWRFcnJvcidcbiAgfCAnQmFja2VuZEJ1aWxkRXJyb3InXG4gIHwgJ0JhY2tlbmRTeW50aEVycm9yJ1xuICB8ICdCb290c3RyYXBOb3REZXRlY3RlZEVycm9yJ1xuICB8ICdDREtSZXNvbHZlQVdTQWNjb3VudEVycm9yJ1xuICB8ICdDREtWZXJzaW9uTWlzbWF0Y2hFcnJvcidcbiAgfCAnQ0ZOVXBkYXRlTm90U3VwcG9ydGVkRXJyb3InXG4gIHwgJ0Nsb3VkRm9ybWF0aW9uRGVwbG95bWVudEVycm9yJ1xuICB8ICdGaWxlUGVybWlzc2lvbnNFcnJvcidcbiAgfCAnTXVsdGlwbGVTYW5kYm94SW5zdGFuY2VzRXJyb3InXG4gIHwgJ0VTQnVpbGRFcnJvcidcbiAgfCAnRXhwaXJlZFRva2VuRXJyb3InXG4gIHwgJ0ZpbGVDb252ZW50aW9uRXJyb3InXG4gIHwgJ0ZpbGVDb252ZW50aW9uRXJyb3InXG4gIHwgJ01vZHVsZU5vdEZvdW5kRXJyb3InXG4gIHwgJ1NlY3JldE5vdFNldEVycm9yJ1xuICB8ICdTeW50YXhFcnJvcic7XG4iXX0=