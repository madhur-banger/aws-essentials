"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AccountIdFetcher = void 0;
const client_sts_1 = require("@aws-sdk/client-sts");
const NO_ACCOUNT_ID = 'NO_ACCOUNT_ID';
/**
 * Retrieves the account ID of the user
 */
class AccountIdFetcher {
    stsClient;
    accountId;
    /**
     * constructor for AccountIdFetcher
     */
    constructor(stsClient = new client_sts_1.STSClient()) {
        this.stsClient = stsClient;
    }
    fetch = async () => {
        if (this.accountId) {
            return this.accountId;
        }
        try {
            const stsResponse = await this.stsClient.send(new client_sts_1.GetCallerIdentityCommand({}));
            if (stsResponse && stsResponse.Account) {
                this.accountId = stsResponse.Account;
                return this.accountId;
            }
            // We failed to get the account Id. Most likely the user doesn't have credentials
            return NO_ACCOUNT_ID;
        }
        catch (error) {
            // We failed to get the account Id. Most likely the user doesn't have credentials
            return NO_ACCOUNT_ID;
        }
    };
}
exports.AccountIdFetcher = AccountIdFetcher;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3VudF9pZF9mZXRjaGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3VzYWdlLWRhdGEvYWNjb3VudF9pZF9mZXRjaGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG9EQUEwRTtBQUUxRSxNQUFNLGFBQWEsR0FBRyxlQUFlLENBQUM7QUFDdEM7O0dBRUc7QUFDSCxNQUFhLGdCQUFnQjtJQUtFO0lBSnJCLFNBQVMsQ0FBcUI7SUFDdEM7O09BRUc7SUFDSCxZQUE2QixZQUFZLElBQUksc0JBQVMsRUFBRTtRQUEzQixjQUFTLEdBQVQsU0FBUyxDQUFrQjtJQUFHLENBQUM7SUFDNUQsS0FBSyxHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ2pCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDdkI7UUFDRCxJQUFJO1lBQ0YsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FDM0MsSUFBSSxxQ0FBd0IsQ0FBQyxFQUFFLENBQUMsQ0FDakMsQ0FBQztZQUNGLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxPQUFPLEVBQUU7Z0JBQ3RDLElBQUksQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQztnQkFDckMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO2FBQ3ZCO1lBQ0QsaUZBQWlGO1lBQ2pGLE9BQU8sYUFBYSxDQUFDO1NBQ3RCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxpRkFBaUY7WUFDakYsT0FBTyxhQUFhLENBQUM7U0FDdEI7SUFDSCxDQUFDLENBQUM7Q0FDSDtBQXpCRCw0Q0F5QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHZXRDYWxsZXJJZGVudGl0eUNvbW1hbmQsIFNUU0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zdHMnO1xuXG5jb25zdCBOT19BQ0NPVU5UX0lEID0gJ05PX0FDQ09VTlRfSUQnO1xuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXJcbiAqL1xuZXhwb3J0IGNsYXNzIEFjY291bnRJZEZldGNoZXIge1xuICBwcml2YXRlIGFjY291bnRJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogY29uc3RydWN0b3IgZm9yIEFjY291bnRJZEZldGNoZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgc3RzQ2xpZW50ID0gbmV3IFNUU0NsaWVudCgpKSB7fVxuICBmZXRjaCA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAodGhpcy5hY2NvdW50SWQpIHtcbiAgICAgIHJldHVybiB0aGlzLmFjY291bnRJZDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0c1Jlc3BvbnNlID0gYXdhaXQgdGhpcy5zdHNDbGllbnQuc2VuZChcbiAgICAgICAgbmV3IEdldENhbGxlcklkZW50aXR5Q29tbWFuZCh7fSlcbiAgICAgICk7XG4gICAgICBpZiAoc3RzUmVzcG9uc2UgJiYgc3RzUmVzcG9uc2UuQWNjb3VudCkge1xuICAgICAgICB0aGlzLmFjY291bnRJZCA9IHN0c1Jlc3BvbnNlLkFjY291bnQ7XG4gICAgICAgIHJldHVybiB0aGlzLmFjY291bnRJZDtcbiAgICAgIH1cbiAgICAgIC8vIFdlIGZhaWxlZCB0byBnZXQgdGhlIGFjY291bnQgSWQuIE1vc3QgbGlrZWx5IHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBjcmVkZW50aWFsc1xuICAgICAgcmV0dXJuIE5PX0FDQ09VTlRfSUQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIFdlIGZhaWxlZCB0byBnZXQgdGhlIGFjY291bnQgSWQuIE1vc3QgbGlrZWx5IHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBjcmVkZW50aWFsc1xuICAgICAgcmV0dXJuIE5PX0FDQ09VTlRfSUQ7XG4gICAgfVxuICB9O1xufVxuIl19