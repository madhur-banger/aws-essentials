import { isAbsolute, resolve } from 'path';
import { GenerateApiCodeFormat, GenerateApiCodeModelTarget, GenerateApiCodeStatementTarget, GenerateApiCodeTypeTarget, } from '@aws-amplify/model-generator';
const DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET = {
    [GenerateApiCodeStatementTarget.JAVASCRIPT]: undefined,
    [GenerateApiCodeStatementTarget.TYPESCRIPT]: GenerateApiCodeTypeTarget.TYPESCRIPT,
    [GenerateApiCodeStatementTarget.GRAPHQL]: undefined,
    [GenerateApiCodeStatementTarget.FLOW]: GenerateApiCodeTypeTarget.FLOW,
    [GenerateApiCodeStatementTarget.ANGULAR]: GenerateApiCodeTypeTarget.ANGULAR,
};
/**
 * Command that generates graphql client code.
 */
export class GenerateGraphqlClientCodeCommand {
    generateApiCodeAdapter;
    backendIdentifierResolver;
    /**
     * @inheritDoc
     */
    command;
    /**
     * @inheritDoc
     */
    describe;
    /**
     * Creates graphql client code generation command.
     */
    constructor(generateApiCodeAdapter, backendIdentifierResolver) {
        this.generateApiCodeAdapter = generateApiCodeAdapter;
        this.backendIdentifierResolver = backendIdentifierResolver;
        this.command = 'graphql-client-code';
        this.describe = 'Generates graphql API code';
    }
    /**
     * @inheritDoc
     */
    handler = async (args) => {
        const backendIdentifier = await this.backendIdentifierResolver.resolveDeployedBackendIdentifier(args);
        const out = this.getOutDir(args);
        const format = args.format ?? GenerateApiCodeFormat.GRAPHQL_CODEGEN;
        const formatParams = this.formatParamBuilders[format](args);
        const result = await this.generateApiCodeAdapter.invokeGenerateApiCode({
            ...backendIdentifier,
            ...formatParams,
        });
        await result.writeToDirectory(out);
    };
    /**
     * @inheritDoc
     */
    builder = (yargs) => {
        return yargs
            .option('stack', {
            conflicts: ['app-id', 'branch'],
            describe: 'A stack name that contains an Amplify backend',
            type: 'string',
            array: false,
            group: 'Stack identifier',
        })
            .option('app-id', {
            conflicts: ['stack'],
            describe: 'The Amplify App ID of the project',
            type: 'string',
            array: false,
            implies: 'branch',
            group: 'Project identifier',
        })
            .option('branch', {
            conflicts: ['stack'],
            describe: 'A git branch of the Amplify project',
            type: 'string',
            array: false,
            group: 'Project identifier',
        })
            .option('out', {
            describe: 'A path to directory where config is written. If not provided defaults to current process working directory.',
            type: 'string',
            array: false,
        })
            .option('format', {
            describe: 'The format that the GraphQL client code should be generated in.',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeFormat),
        })
            .option('model-target', {
            describe: 'The modelgen export target. Only applies when the `--format` parameter is set to `modelgen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeModelTarget),
        })
            .option('statement-target', {
            describe: 'The graphql-codegen statement export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeStatementTarget),
        })
            .option('type-target', {
            describe: 'The optional graphql-codegen type export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeTypeTarget),
        })
            .option('model-generate-index-rules', {
            description: 'Adds key/index details to iOS models',
            type: 'boolean',
            array: false,
        })
            .option('model-emit-auth-provider', {
            description: 'Adds auth provider details to iOS models',
            type: 'boolean',
            array: false,
        })
            .option('model-respect-primary-key-attributes-on-connection-field', {
            description: 'If enabled, Datastore queries will respect the primary + sort key fields, rather than a default id field',
            type: 'boolean',
            array: false,
        })
            .option('model-generate-models-for-lazy-load-and-custom-selection-set', {
            description: 'Generates lazy model type definitions, required or amplify-js v5+',
            type: 'boolean',
            array: false,
        })
            .option('model-add-timestamp-fields', {
            description: 'Add read-only timestamp fields in modelgen.',
            type: 'boolean',
            array: false,
        })
            .option('model-handle-list-nullability-transparently', {
            description: 'Configure the nullability of the List and List components in Datastore Models generation',
            type: 'boolean',
            array: false,
        })
            .option('statement-max-depth', {
            description: 'Determines how deeply nested to generate graphql statements.',
            type: 'number',
            array: false,
        })
            .option('statement-typename-introspection', {
            description: 'Determines whether to include default __typename for all generated statements',
            type: 'boolean',
            array: false,
        })
            .option('type-multiple-swift-files', {
            description: 'Determines whether or not to generate a single API.swift, or multiple per-model swift files.',
            type: 'boolean',
            array: false,
        });
    };
    /**
     * Produce the required input for graphql-codegen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the codegen options config
     */
    getGraphqlCodegenFormatParams = (args) => {
        const statementTarget = args['statement-target'] ?? GenerateApiCodeStatementTarget.TYPESCRIPT;
        const typeTarget = args['type-target'] ??
            DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET[statementTarget];
        const maxDepth = args['statement-max-depth'];
        const typeNameIntrospection = args['statement-typename-introspection'];
        const multipleSwiftFiles = args['type-multiple-swift-files'];
        return {
            format: GenerateApiCodeFormat.GRAPHQL_CODEGEN,
            statementTarget,
            ...(typeTarget !== undefined ? { typeTarget } : {}),
            ...(maxDepth !== undefined ? { maxDepth } : {}),
            ...(typeNameIntrospection !== undefined ? { typeNameIntrospection } : {}),
            ...(multipleSwiftFiles !== undefined ? { multipleSwiftFiles } : {}),
        };
    };
    /**
     * Produce the required input for modelgen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the modelgen options config
     */
    getModelgenFormatParams = (args) => {
        const modelTarget = args['model-target'] ?? GenerateApiCodeModelTarget.TYPESCRIPT;
        const generateIndexRules = args['model-generate-index-rules'];
        const emitAuthProvider = args['model-emit-auth-provider'];
        const respectPrimaryKeyAttributesOnConnectionField = args['model-respect-primary-key-attributes-on-connection-field'];
        const generateModelsForLazyLoadAndCustomSelectionSet = args['model-generate-models-for-lazy-load-and-custom-selection-set'];
        const addTimestampFields = args['model-add-timestamp-fields'];
        const handleListNullabilityTransparently = args['model-handle-list-nullability-transparently'];
        return {
            format: GenerateApiCodeFormat.MODELGEN,
            modelTarget,
            ...(generateIndexRules !== undefined ? { generateIndexRules } : {}),
            ...(emitAuthProvider !== undefined ? { emitAuthProvider } : {}),
            ...(respectPrimaryKeyAttributesOnConnectionField !== undefined
                ? { respectPrimaryKeyAttributesOnConnectionField }
                : {}),
            ...(generateModelsForLazyLoadAndCustomSelectionSet !== undefined
                ? { generateModelsForLazyLoadAndCustomSelectionSet }
                : {}),
            ...(addTimestampFields !== undefined ? { addTimestampFields } : {}),
            ...(handleListNullabilityTransparently !== undefined
                ? { handleListNullabilityTransparently }
                : {}),
        };
    };
    /**
     * Produce the introspection schema config shape.
     * @returns the introspection options config
     */
    getIntrospectionFormatParams = () => ({
        format: GenerateApiCodeFormat.INTROSPECTION,
    });
    getOutDir = (args) => {
        const cwd = process.cwd();
        if (!args.out) {
            return cwd;
        }
        return isAbsolute(args.out) ? args.out : resolve(cwd, args.out);
    };
    // This property references other methods in the class so it must be defined at the end.
    // This is probably an indicator that some refactoring should happen here but right now I'm just trying to apply this lint rule to the codebase
    // eslint-disable-next-line @typescript-eslint/member-ordering
    formatParamBuilders = {
        [GenerateApiCodeFormat.MODELGEN]: this.getModelgenFormatParams,
        [GenerateApiCodeFormat.GRAPHQL_CODEGEN]: this.getGraphqlCodegenFormatParams,
        [GenerateApiCodeFormat.INTROSPECTION]: this.getIntrospectionFormatParams,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1hbmRzL2dlbmVyYXRlL2dyYXBocWwtY2xpZW50LWNvZGUvZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSzNDLE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsMEJBQTBCLEVBQzFCLDhCQUE4QixFQUM5Qix5QkFBeUIsR0FJMUIsTUFBTSw4QkFBOEIsQ0FBQztBQStCdEMsTUFBTSx3Q0FBd0MsR0FHMUM7SUFDRixDQUFDLDhCQUE4QixDQUFDLFVBQVUsQ0FBQyxFQUFFLFNBQVM7SUFDdEQsQ0FBQyw4QkFBOEIsQ0FBQyxVQUFVLENBQUMsRUFDekMseUJBQXlCLENBQUMsVUFBVTtJQUN0QyxDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxFQUFFLFNBQVM7SUFDbkQsQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsRUFBRSx5QkFBeUIsQ0FBQyxJQUFJO0lBQ3JFLENBQUMsOEJBQThCLENBQUMsT0FBTyxDQUFDLEVBQUUseUJBQXlCLENBQUMsT0FBTztDQUM1RSxDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFNLE9BQU8sZ0NBQWdDO0lBaUJ4QjtJQUNBO0lBZm5COztPQUVHO0lBQ00sT0FBTyxDQUFTO0lBRXpCOztPQUVHO0lBQ00sUUFBUSxDQUFTO0lBRTFCOztPQUVHO0lBQ0gsWUFDbUIsc0JBQThDLEVBQzlDLHlCQUFvRDtRQURwRCwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFFckUsSUFBSSxDQUFDLE9BQU8sR0FBRyxxQkFBcUIsQ0FBQztRQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFH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QUNSLENBQUM7SUFDSixDQUFDLENBQUM7SUFFRjs7O09BR0c7SUFDSyw0QkFBNEIsR0FBRyxHQUFpQyxFQUFFLENBQUMsQ0FBQztRQUMxRSxNQUFNLEVBQUUscUJBQXFCLENBQUMsYUFBYTtLQUM1QyxDQUFDLENBQUM7SUFFSyxTQUFTLEdBQUcsQ0FBQyxJQUE2QyxFQUFFLEVBQUU7UUFDcEUsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ2IsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUNELE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEUsQ0FBQyxDQUFDO0lBRUYsd0ZBQXdGO0lBQ3hGLCtJQUErSTtJQUMvSSw4REFBOEQ7SUFDdEQsbUJBQW1CLEdBR3ZCO1FBQ0YsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLENBQUMsdUJBQXVCO1FBQzlELENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLEVBQUUsSUFBSSxDQUFDLDZCQUE2QjtRQUMzRSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxFQUFFLElBQUksQ0FBQyw0QkFBNEI7S0FDekUsQ0FBQztDQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXJndW1lbnRzQ2FtZWxDYXNlLCBBcmd2LCBDb21tYW5kTW9kdWxlIH0gZnJvbSAneWFyZ3MnO1xuaW1wb3J0IHsgQmFja2VuZElkZW50aWZpZXJSZXNvbHZlciB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQtaWRlbnRpZmllci9iYWNrZW5kX2lkZW50aWZpZXJfcmVzb2x2ZXIuanMnO1xuaW1wb3J0IHsgaXNBYnNvbHV0ZSwgcmVzb2x2ZSB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtcbiAgR2VuZXJhdGVBcGlDb2RlQWRhcHRlcixcbiAgSW52b2tlR2VuZXJhdGVBcGlDb2RlUHJvcHMsXG59IGZyb20gJy4vZ2VuZXJhdGVfYXBpX2NvZGVfYWRhcHRlci5qcyc7XG5pbXBvcnQge1xuICBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQsXG4gIEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0LFxuICBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQsXG4gIEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQsXG4gIEdlbmVyYXRlR3JhcGhxbENvZGVnZW5PcHRpb25zLFxuICBHZW5lcmF0ZUludHJvc3BlY3Rpb25PcHRpb25zLFxuICBHZW5lcmF0ZU1vZGVsc09wdGlvbnMsXG59IGZyb20gJ0Bhd3MtYW1wbGlmeS9tb2RlbC1nZW5lcmF0b3InO1xuaW1wb3J0IHsgQXJndW1lbnRzS2ViYWJDYXNlIH0gZnJvbSAnLi4vLi4vLi4va2ViYWJfY2FzZS5qcyc7XG5cbnR5cGUgR2VuZXJhdGVPcHRpb25zID1cbiAgfCBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9uc1xuICB8IEdlbmVyYXRlTW9kZWxzT3B0aW9uc1xuICB8IEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnM7XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9ucyA9XG4gIEFyZ3VtZW50c0tlYmFiQ2FzZTxHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNDYW1lbENhc2U+O1xuXG50eXBlIEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9uc0NhbWVsQ2FzZSA9IHtcbiAgc3RhY2s6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgYXBwSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgYnJhbmNoOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0IHwgdW5kZWZpbmVkO1xuICBtb2RlbFRhcmdldDogR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQgfCB1bmRlZmluZWQ7XG4gIHN0YXRlbWVudFRhcmdldDogR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0IHwgdW5kZWZpbmVkO1xuICB0eXBlVGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0IHwgdW5kZWZpbmVkO1xuICBvdXQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgbW9kZWxHZW5lcmF0ZUluZGV4UnVsZXM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIG1vZGVsRW1pdEF1dGhQcm92aWRlcjogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxSZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxHZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0OiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBtb2RlbEFkZFRpbWVzdGFtcEZpZWxkczogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxIYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5OiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBzdGF0ZW1lbnRNYXhEZXB0aDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBzdGF0ZW1lbnRUeXBlbmFtZUludHJvc3BlY3Rpb246IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIHR5cGVNdWx0aXBsZVN3aWZ0RmlsZXM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBERUZBVUxUX1RZUEVfVEFSR0VUX0ZPUl9TVEFURU1FTlRfVEFSR0VUOiBSZWNvcmQ8XG4gIEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldCxcbiAgR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldCB8IHVuZGVmaW5lZFxuPiA9IHtcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5KQVZBU0NSSVBUXTogdW5kZWZpbmVkLFxuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LlRZUEVTQ1JJUFRdOlxuICAgIEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuVFlQRVNDUklQVCxcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5HUkFQSFFMXTogdW5kZWZpbmVkLFxuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LkZMT1ddOiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0LkZMT1csXG4gIFtHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuQU5HVUxBUl06IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuQU5HVUxBUixcbn07XG5cbi8qKlxuICogQ29tbWFuZCB0aGF0IGdlbmVyYXRlcyBncmFwaHFsIGNsaWVudCBjb2RlLlxuICovXG5leHBvcnQgY2xhc3MgR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRcbiAgaW1wbGVtZW50cyBDb21tYW5kTW9kdWxlPG9iamVjdCwgR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zPlxue1xuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHJlYWRvbmx5IGNvbW1hbmQ6IHN0cmluZztcblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaWJlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgZ3JhcGhxbCBjbGllbnQgY29kZSBnZW5lcmF0aW9uIGNvbW1hbmQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdlbmVyYXRlQXBpQ29kZUFkYXB0ZXI6IEdlbmVyYXRlQXBpQ29kZUFkYXB0ZXIsXG4gICAgcHJpdmF0ZSByZWFkb25seSBiYWNrZW5kSWRlbnRpZmllclJlc29sdmVyOiBCYWNrZW5kSWRlbnRpZmllclJlc29sdmVyXG4gICkge1xuICAgIHRoaXMuY29tbWFuZCA9ICdncmFwaHFsLWNsaWVudC1jb2RlJztcbiAgICB0aGlzLmRlc2NyaWJlID0gJ0dlbmVyYXRlcyBncmFwaHFsIEFQSSBjb2RlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgaGFuZGxlciA9IGFzeW5jIChcbiAgICBhcmdzOiBBcmd1bWVudHNDYW1lbENhc2U8R2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zPlxuICApOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBjb25zdCBiYWNrZW5kSWRlbnRpZmllciA9XG4gICAgICBhd2FpdCB0aGlzLmJhY2tlbmRJZGVudGlmaWVyUmVzb2x2ZXIucmVzb2x2ZURlcGxveWVkQmFja2VuZElkZW50aWZpZXIoXG4gICAgICAgIGFyZ3NcbiAgICAgICk7XG4gICAgY29uc3Qgb3V0ID0gdGhpcy5nZXRPdXREaXIoYXJncyk7XG4gICAgY29uc3QgZm9ybWF0ID0gYXJncy5mb3JtYXQgPz8gR2VuZXJhdGVBcGlDb2RlRm9ybWF0LkdSQVBIUUxfQ09ERUdFTjtcbiAgICBjb25zdCBmb3JtYXRQYXJhbXMgPSB0aGlzLmZvcm1hdFBhcmFtQnVpbGRlcnNbZm9ybWF0XShhcmdzKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVBcGlDb2RlQWRhcHRlci5pbnZva2VHZW5lcmF0ZUFwaUNvZGUoe1xuICAgICAgLi4uYmFja2VuZElkZW50aWZpZXIsXG4gICAgICAuLi5mb3JtYXRQYXJhbXMsXG4gICAgfSBhcyB1bmtub3duIGFzIEludm9rZUdlbmVyYXRlQXBpQ29kZVByb3BzKTtcblxuICAgIGF3YWl0IHJlc3VsdC53cml0ZVRvRGlyZWN0b3J5KG91dCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0RG9jXG4gICAqL1xuICBidWlsZGVyID0gKHlhcmdzOiBBcmd2KTogQXJndjxHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnM+ID0+IHtcbiAgICByZXR1cm4geWFyZ3NcbiAgICAgIC5vcHRpb24oJ3N0YWNrJywge1xuICAgICAgICBjb25mbGljdHM6IFsnYXBwLWlkJywgJ2JyYW5jaCddLFxuICAgICAgICBkZXNjcmliZTogJ0Egc3RhY2sgbmFtZSB0aGF0IGNvbnRhaW5zIGFuIEFtcGxpZnkgYmFja2VuZCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGdyb3VwOiAnU3RhY2sgaWRlbnRpZmllcicsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignYXBwLWlkJywge1xuICAgICAgICBjb25mbGljdHM6IFsnc3RhY2snXSxcbiAgICAgICAgZGVzY3JpYmU6ICdUaGUgQW1wbGlmeSBBcHAgSUQgb2YgdGhlIHByb2plY3QnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBpbXBsaWVzOiAnYnJhbmNoJyxcbiAgICAgICAgZ3JvdXA6ICdQcm9qZWN0IGlkZW50aWZpZXInLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ2JyYW5jaCcsIHtcbiAgICAgICAgY29uZmxpY3RzOiBbJ3N0YWNrJ10sXG4gICAgICAgIGRlc2NyaWJlOiAnQSBnaXQgYnJhbmNoIG9mIHRoZSBBbXBsaWZ5IHByb2plY3QnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBncm91cDogJ1Byb2plY3QgaWRlbnRpZmllcicsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignb3V0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnQSBwYXRoIHRvIGRpcmVjdG9yeSB3aGVyZSBjb25maWcgaXMgd3JpdHRlbi4gSWYgbm90IHByb3ZpZGVkIGRlZmF1bHRzIHRvIGN1cnJlbnQgcHJvY2VzcyB3b3JraW5nIGRpcmVjdG9yeS4nLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ2Zvcm1hdCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ1RoZSBmb3JtYXQgdGhhdCB0aGUgR3JhcGhRTCBjbGllbnQgY29kZSBzaG91bGQgYmUgZ2VuZXJhdGVkIGluLicsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGNob2ljZXM6IE9iamVjdC52YWx1ZXMoR2VuZXJhdGVBcGlDb2RlRm9ybWF0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC10YXJnZXQnLCB7XG4gICAgICAgIGRlc2NyaWJlOlxuICAgICAgICAgICdUaGUgbW9kZWxnZW4gZXhwb3J0IHRhcmdldC4gT25seSBhcHBsaWVzIHdoZW4gdGhlIGAtLWZvcm1hdGAgcGFyYW1ldGVyIGlzIHNldCB0byBgbW9kZWxnZW5gJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhHZW5lcmF0ZUFwaUNvZGVNb2RlbFRhcmdldCksXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignc3RhdGVtZW50LXRhcmdldCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ1RoZSBncmFwaHFsLWNvZGVnZW4gc3RhdGVtZW50IGV4cG9ydCB0YXJnZXQuIE9ubHkgYXBwbGllcyB3aGVuIHRoZSBgLS1mb3JtYXRgIHBhcmFtZXRlciBpcyBzZXQgdG8gYGdyYXBocWwtY29kZWdlbmAnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBjaG9pY2VzOiBPYmplY3QudmFsdWVzKEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldCksXG4gICAgICB9KVxuICAgICAgLm9wdGlvbigndHlwZS10YXJnZXQnLCB7XG4gICAgICAgIGRlc2NyaWJlOlxuICAgICAgICAgICdUaGUgb3B0aW9uYWwgZ3JhcGhxbC1jb2RlZ2VuIHR5cGUgZXhwb3J0IHRhcmdldC4gT25seSBhcHBsaWVzIHdoZW4gdGhlIGAtLWZvcm1hdGAgcGFyYW1ldGVyIGlzIHNldCB0byBgZ3JhcGhxbC1jb2RlZ2VuYCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGNob2ljZXM6IE9iamVjdC52YWx1ZXMoR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldCksXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtZ2VuZXJhdGUtaW5kZXgtcnVsZXMnLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQWRkcyBrZXkvaW5kZXggZGV0YWlscyB0byBpT1MgbW9kZWxzJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtZW1pdC1hdXRoLXByb3ZpZGVyJywge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0FkZHMgYXV0aCBwcm92aWRlciBkZXRhaWxzIHRvIGlPUyBtb2RlbHMnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1yZXNwZWN0LXByaW1hcnkta2V5LWF0dHJpYnV0ZXMtb24tY29ubmVjdGlvbi1maWVsZCcsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0lmIGVuYWJsZWQsIERhdGFzdG9yZSBxdWVyaWVzIHdpbGwgcmVzcGVjdCB0aGUgcHJpbWFyeSArIHNvcnQga2V5IGZpZWxkcywgcmF0aGVyIHRoYW4gYSBkZWZhdWx0IGlkIGZpZWxkJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtZ2VuZXJhdGUtbW9kZWxzLWZvci1sYXp5LWxvYWQtYW5kLWN1c3RvbS1zZWxlY3Rpb24tc2V0Jywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnR2VuZXJhdGVzIGxhenkgbW9kZWwgdHlwZSBkZWZpbml0aW9ucywgcmVxdWlyZWQgb3IgYW1wbGlmeS1qcyB2NSsnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1hZGQtdGltZXN0YW1wLWZpZWxkcycsIHtcbiAgICAgICAgZGVzY3JpcHRpb246ICdBZGQgcmVhZC1vbmx5IHRpbWVzdGFtcCBmaWVsZHMgaW4gbW9kZWxnZW4uJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtaGFuZGxlLWxpc3QtbnVsbGFiaWxpdHktdHJhbnNwYXJlbnRseScsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0NvbmZpZ3VyZSB0aGUgbnVsbGFiaWxpdHkgb2YgdGhlIExpc3QgYW5kIExpc3QgY29tcG9uZW50cyBpbiBEYXRhc3RvcmUgTW9kZWxzIGdlbmVyYXRpb24nLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdzdGF0ZW1lbnQtbWF4LWRlcHRoJywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnRGV0ZXJtaW5lcyBob3cgZGVlcGx5IG5lc3RlZCB0byBnZW5lcmF0ZSBncmFwaHFsIHN0YXRlbWVudHMuJyxcbiAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdzdGF0ZW1lbnQtdHlwZW5hbWUtaW50cm9zcGVjdGlvbicsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0RldGVybWluZXMgd2hldGhlciB0byBpbmNsdWRlIGRlZmF1bHQgX190eXBlbmFtZSBmb3IgYWxsIGdlbmVyYXRlZCBzdGF0ZW1lbnRzJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbigndHlwZS1tdWx0aXBsZS1zd2lmdC1maWxlcycsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0RldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gZ2VuZXJhdGUgYSBzaW5nbGUgQVBJLnN3aWZ0LCBvciBtdWx0aXBsZSBwZXItbW9kZWwgc3dpZnQgZmlsZXMuJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogUHJvZHVjZSB0aGUgcmVxdWlyZWQgaW5wdXQgZm9yIGdyYXBocWwtY29kZWdlbiBjYWxscyBmcm9tIHRoZSBDTEkgaW5wdXQsIGFwcGx5aW5nIHNhbmUgZGVmYXVsdHMgd2hlcmUgYXBwbGljYWJsZS5cbiAgICogQHBhcmFtIGFyZ3MgQ0xJIGFyZ3MgcHJvdmlkZWQgYnkgdGhlIGN1c3RvbWVyXG4gICAqIEByZXR1cm5zIHRoZSBjb2RlZ2VuIG9wdGlvbnMgY29uZmlnXG4gICAqL1xuICBwcml2YXRlIGdldEdyYXBocWxDb2RlZ2VuRm9ybWF0UGFyYW1zID0gKFxuICAgIGFyZ3M6IEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9uc1xuICApOiBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9ucyA9PiB7XG4gICAgY29uc3Qgc3RhdGVtZW50VGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQgPVxuICAgICAgYXJnc1snc3RhdGVtZW50LXRhcmdldCddID8/IEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5UWVBFU0NSSVBUO1xuICAgIGNvbnN0IHR5cGVUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQgfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1sndHlwZS10YXJnZXQnXSA/P1xuICAgICAgREVGQVVMVF9UWVBFX1RBUkdFVF9GT1JfU1RBVEVNRU5UX1RBUkdFVFtzdGF0ZW1lbnRUYXJnZXRdO1xuICAgIGNvbnN0IG1heERlcHRoOiBudW1iZXIgfCB1bmRlZmluZWQgPSBhcmdzWydzdGF0ZW1lbnQtbWF4LWRlcHRoJ107XG4gICAgY29uc3QgdHlwZU5hbWVJbnRyb3NwZWN0aW9uOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3N0YXRlbWVudC10eXBlbmFtZS1pbnRyb3NwZWN0aW9uJ107XG4gICAgY29uc3QgbXVsdGlwbGVTd2lmdEZpbGVzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3R5cGUtbXVsdGlwbGUtc3dpZnQtZmlsZXMnXTtcblxuICAgIHJldHVybiB7XG4gICAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5HUkFQSFFMX0NPREVHRU4sXG4gICAgICBzdGF0ZW1lbnRUYXJnZXQsXG4gICAgICAuLi4odHlwZVRhcmdldCAhPT0gdW5kZWZpbmVkID8geyB0eXBlVGFyZ2V0IH0gOiB7fSksXG4gICAgICAuLi4obWF4RGVwdGggIT09IHVuZGVmaW5lZCA/IHsgbWF4RGVwdGggfSA6IHt9KSxcbiAgICAgIC4uLih0eXBlTmFtZUludHJvc3BlY3Rpb24gIT09IHVuZGVmaW5lZCA/IHsgdHlwZU5hbWVJbnRyb3NwZWN0aW9uIH0gOiB7fSksXG4gICAgICAuLi4obXVsdGlwbGVTd2lmdEZpbGVzICE9PSB1bmRlZmluZWQgPyB7IG11bHRpcGxlU3dpZnRGaWxlcyB9IDoge30pLFxuICAgIH07XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb2R1Y2UgdGhlIHJlcXVpcmVkIGlucHV0IGZvciBtb2RlbGdlbiBjYWxscyBmcm9tIHRoZSBDTEkgaW5wdXQsIGFwcGx5aW5nIHNhbmUgZGVmYXVsdHMgd2hlcmUgYXBwbGljYWJsZS5cbiAgICogQHBhcmFtIGFyZ3MgQ0xJIGFyZ3MgcHJvdmlkZWQgYnkgdGhlIGN1c3RvbWVyXG4gICAqIEByZXR1cm5zIHRoZSBtb2RlbGdlbiBvcHRpb25zIGNvbmZpZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRNb2RlbGdlbkZvcm1hdFBhcmFtcyA9IChcbiAgICBhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNcbiAgKTogR2VuZXJhdGVNb2RlbHNPcHRpb25zID0+IHtcbiAgICBjb25zdCBtb2RlbFRhcmdldDogR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQgPVxuICAgICAgYXJnc1snbW9kZWwtdGFyZ2V0J10gPz8gR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQuVFlQRVNDUklQVDtcbiAgICBjb25zdCBnZW5lcmF0ZUluZGV4UnVsZXM6IGJvb2xlYW4gfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1snbW9kZWwtZ2VuZXJhdGUtaW5kZXgtcnVsZXMnXTtcbiAgICBjb25zdCBlbWl0QXV0aFByb3ZpZGVyOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWVtaXQtYXV0aC1wcm92aWRlciddO1xuICAgIGNvbnN0IHJlc3BlY3RQcmltYXJ5S2V5QXR0cmlidXRlc09uQ29ubmVjdGlvbkZpZWxkOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLXJlc3BlY3QtcHJpbWFyeS1rZXktYXR0cmlidXRlcy1vbi1jb25uZWN0aW9uLWZpZWxkJ107XG4gICAgY29uc3QgZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldDogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1nZW5lcmF0ZS1tb2RlbHMtZm9yLWxhenktbG9hZC1hbmQtY3VzdG9tLXNlbGVjdGlvbi1zZXQnXTtcbiAgICBjb25zdCBhZGRUaW1lc3RhbXBGaWVsZHM6IGJvb2xlYW4gfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1snbW9kZWwtYWRkLXRpbWVzdGFtcC1maWVsZHMnXTtcbiAgICBjb25zdCBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5OiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWhhbmRsZS1saXN0LW51bGxhYmlsaXR5LXRyYW5zcGFyZW50bHknXTtcblxuICAgIHJldHVybiB7XG4gICAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5NT0RFTEdFTixcbiAgICAgIG1vZGVsVGFyZ2V0LFxuICAgICAgLi4uKGdlbmVyYXRlSW5kZXhSdWxlcyAhPT0gdW5kZWZpbmVkID8geyBnZW5lcmF0ZUluZGV4UnVsZXMgfSA6IHt9KSxcbiAgICAgIC4uLihlbWl0QXV0aFByb3ZpZGVyICE9PSB1bmRlZmluZWQgPyB7IGVtaXRBdXRoUHJvdmlkZXIgfSA6IHt9KSxcbiAgICAgIC4uLihyZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZCAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8geyByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZCB9XG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQgIT09IHVuZGVmaW5lZFxuICAgICAgICA/IHsgZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldCB9XG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGFkZFRpbWVzdGFtcEZpZWxkcyAhPT0gdW5kZWZpbmVkID8geyBhZGRUaW1lc3RhbXBGaWVsZHMgfSA6IHt9KSxcbiAgICAgIC4uLihoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5ICE9PSB1bmRlZmluZWRcbiAgICAgICAgPyB7IGhhbmRsZUxpc3ROdWxsYWJpbGl0eVRyYW5zcGFyZW50bHkgfVxuICAgICAgICA6IHt9KSxcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcm9kdWNlIHRoZSBpbnRyb3NwZWN0aW9uIHNjaGVtYSBjb25maWcgc2hhcGUuXG4gICAqIEByZXR1cm5zIHRoZSBpbnRyb3NwZWN0aW9uIG9wdGlvbnMgY29uZmlnXG4gICAqL1xuICBwcml2YXRlIGdldEludHJvc3BlY3Rpb25Gb3JtYXRQYXJhbXMgPSAoKTogR2VuZXJhdGVJbnRyb3NwZWN0aW9uT3B0aW9ucyA9PiAoe1xuICAgIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0LklOVFJPU1BFQ1RJT04sXG4gIH0pO1xuXG4gIHByaXZhdGUgZ2V0T3V0RGlyID0gKGFyZ3M6IEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IGN3ZCA9IHByb2Nlc3MuY3dkKCk7XG4gICAgaWYgKCFhcmdzLm91dCkge1xuICAgICAgcmV0dXJuIGN3ZDtcbiAgICB9XG4gICAgcmV0dXJuIGlzQWJzb2x1dGUoYXJncy5vdXQpID8gYXJncy5vdXQgOiByZXNvbHZlKGN3ZCwgYXJncy5vdXQpO1xuICB9O1xuXG4gIC8vIFRoaXMgcHJvcGVydHkgcmVmZXJlbmNlcyBvdGhlciBtZXRob2RzIGluIHRoZSBjbGFzcyBzbyBpdCBtdXN0IGJlIGRlZmluZWQgYXQgdGhlIGVuZC5cbiAgLy8gVGhpcyBpcyBwcm9iYWJseSBhbiBpbmRpY2F0b3IgdGhhdCBzb21lIHJlZmFjdG9yaW5nIHNob3VsZCBoYXBwZW4gaGVyZSBidXQgcmlnaHQgbm93IEknbSBqdXN0IHRyeWluZyB0byBhcHBseSB0aGlzIGxpbnQgcnVsZSB0byB0aGUgY29kZWJhc2VcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9tZW1iZXItb3JkZXJpbmdcbiAgcHJpdmF0ZSBmb3JtYXRQYXJhbUJ1aWxkZXJzOiBSZWNvcmQ8XG4gICAgR2VuZXJhdGVBcGlDb2RlRm9ybWF0LFxuICAgIChhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnMpID0+IEdlbmVyYXRlT3B0aW9uc1xuICA+ID0ge1xuICAgIFtHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuTU9ERUxHRU5dOiB0aGlzLmdldE1vZGVsZ2VuRm9ybWF0UGFyYW1zLFxuICAgIFtHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuR1JBUEhRTF9DT0RFR0VOXTogdGhpcy5nZXRHcmFwaHFsQ29kZWdlbkZvcm1hdFBhcmFtcyxcbiAgICBbR2VuZXJhdGVBcGlDb2RlRm9ybWF0LklOVFJPU1BFQ1RJT05dOiB0aGlzLmdldEludHJvc3BlY3Rpb25Gb3JtYXRQYXJhbXMsXG4gIH07XG59XG4iXX0=