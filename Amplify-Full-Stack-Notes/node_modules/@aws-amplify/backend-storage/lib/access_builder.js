import { entityIdSubstitution } from './constants.js';
export const roleAccessBuilder = {
    authenticated: {
        to: (actions) => ({
            getResourceAccessAcceptors: [getAuthRoleResourceAccessAcceptor],
            uniqueDefinitionIdValidations: [
                {
                    uniqueDefinitionId: `authenticated`,
                    validationErrorOptions: {
                        message: `Entity access definition for authenticated users specified multiple times.`,
                        resolution: `Combine all access definitions for authenticated users on a single path into one access rule.`,
                    },
                },
            ],
            actions,
            idSubstitution: '*',
        }),
    },
    guest: {
        to: (actions) => ({
            getResourceAccessAcceptors: [getUnauthRoleResourceAccessAcceptor],
            uniqueDefinitionIdValidations: [
                {
                    uniqueDefinitionId: `guest`,
                    validationErrorOptions: {
                        message: `Entity access definition for guest users specified multiple times.`,
                        resolution: `Combine all access definitions for guest users on a single path into one access rule.`,
                    },
                },
            ],
            actions,
            idSubstitution: '*',
        }),
    },
    groups: (groupNames) => ({
        to: (actions) => ({
            getResourceAccessAcceptors: groupNames.map((groupName) => (getInstanceProps) => getUserRoleResourceAccessAcceptor(getInstanceProps, groupName)),
            uniqueDefinitionIdValidations: groupNames.map((groupName) => ({
                uniqueDefinitionId: `groups${groupName}`,
                validationErrorOptions: {
                    message: `Group access definition for ${groupName} specified multiple times.`,
                    resolution: `Combine all access definitions for ${groupName} on a single path into one access rule.`,
                },
            })),
            actions,
            idSubstitution: '*',
        }),
    }),
    entity: (entityId) => ({
        to: (actions) => ({
            getResourceAccessAcceptors: [getAuthRoleResourceAccessAcceptor],
            uniqueDefinitionIdValidations: [
                {
                    uniqueDefinitionId: `entity${entityId}`,
                    validationErrorOptions: {
                        message: `Entity access definition for ${entityId} specified multiple times.`,
                        resolution: `Combine all access definitions for ${entityId} on a single path into one access rule.`,
                    },
                },
            ],
            actions,
            idSubstitution: entityIdSubstitution,
        }),
    }),
    resource: (other) => ({
        to: (actions) => ({
            getResourceAccessAcceptors: [
                (getInstanceProps) => other.getInstance(getInstanceProps).getResourceAccessAcceptor(),
            ],
            uniqueDefinitionIdValidations: [],
            actions,
            idSubstitution: '*',
        }),
    }),
};
const getAuthRoleResourceAccessAcceptor = (getInstanceProps) => getUserRoleResourceAccessAcceptor(getInstanceProps, 'authenticatedUserIamRole');
const getUnauthRoleResourceAccessAcceptor = (getInstanceProps) => getUserRoleResourceAccessAcceptor(getInstanceProps, 'unauthenticatedUserIamRole');
const getUserRoleResourceAccessAcceptor = (getInstanceProps, roleName) => {
    const resourceAccessAcceptor = getInstanceProps.constructContainer
        .getConstructFactory('AuthResources')
        ?.getInstance(getInstanceProps)
        .getResourceAccessAcceptor(roleName);
    if (!resourceAccessAcceptor) {
        throw new Error(`Cannot specify auth access for ${roleName} users without defining auth. See https://docs.amplify.aws/gen2/build-a-backend/auth/set-up-auth/ for more information.`);
    }
    return resourceAccessAcceptor;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjZXNzX2J1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvYWNjZXNzX2J1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBT0EsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdEQsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQXlCO0lBQ3JELGFBQWEsRUFBRTtRQUNiLEVBQUUsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNoQiwwQkFBMEIsRUFBRSxDQUFDLGlDQUFpQyxDQUFDO1lBQy9ELDZCQUE2QixFQUFFO2dCQUM3QjtvQkFDRSxrQkFBa0IsRUFBRSxlQUFlO29CQUNuQyxzQkFBc0IsRUFBRTt3QkFDdEIsT0FBTyxFQUFFLDRFQUE0RTt3QkFDckYsVUFBVSxFQUFFLCtGQUErRjtxQkFDNUc7aUJBQ0Y7YUFDRjtZQUNELE9BQU87WUFDUCxjQUFjLEVBQUUsR0FBRztTQUNwQixDQUFDO0tBQ0g7SUFDRCxLQUFLLEVBQUU7UUFDTCxFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDaEIsMEJBQTBCLEVBQUUsQ0FBQyxtQ0FBbUMsQ0FBQztZQUNqRSw2QkFBNkIsRUFBRTtnQkFDN0I7b0JBQ0Usa0JBQWtCLEVBQUUsT0FBTztvQkFDM0Isc0JBQXNCLEVBQUU7d0JBQ3RCLE9BQU8sRUFBRSxvRUFBb0U7d0JBQzdFLFVBQVUsRUFBRSx1RkFBdUY7cUJBQ3BHO2lCQUNGO2FBQ0Y7WUFDRCxPQUFPO1lBQ1AsY0FBYyxFQUFFLEdBQUc7U0FDcEIsQ0FBQztLQUNIO0lBQ0QsTUFBTSxFQUFFLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLEVBQUUsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNoQiwwQkFBMEIsRUFBRSxVQUFVLENBQUMsR0FBRyxDQUN4QyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLENBQ2xDLGlDQUFpQyxDQUFDLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxDQUNqRTtZQUNELDZCQUE2QixFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQzVELGtCQUFrQixFQUFFLFNBQVMsU0FBUyxFQUFFO2dCQUN4QyxzQkFBc0IsRUFBRTtvQkFDdEIsT0FBTyxFQUFFLCtCQUErQixTQUFTLDRCQUE0QjtvQkFDN0UsVUFBVSxFQUFFLHNDQUFzQyxTQUFTLHlDQUF5QztpQkFDckc7YUFDRixDQUFDLENBQUM7WUFDSCxPQUFPO1lBQ1AsY0FBYyxFQUFFLEdBQUc7U0FDcEIsQ0FBQztLQUNILENBQUM7SUFDRixNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckIsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ2hCLDBCQUEwQixFQUFFLENBQUMsaUNBQWlDLENBQUM7WUFDL0QsNkJBQTZCLEVBQUU7Z0JBQzdCO29CQUNFLGtCQUFrQixFQUFFLFNBQVMsUUFBUSxFQUFFO29CQUN2QyxzQkFBc0IsRUFBRTt3QkFDdEIsT0FBTyxFQUFFLGdDQUFnQyxRQUFRLDRCQUE0Qjt3QkFDN0UsVUFBVSxFQUFFLHNDQUFzQyxRQUFRLHlDQUF5QztxQkFDcEc7aUJBQ0Y7YUFDRjtZQUNELE9BQU87WUFDUCxjQUFjLEVBQUUsb0JBQW9CO1NBQ3JDLENBQUM7S0FDSCxDQUFDO0lBQ0YsUUFBUSxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3BCLEVBQUUsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNoQiwwQkFBMEIsRUFBRTtnQkFDMUIsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLENBQ25CLEtBQUssQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyx5QkFBeUIsRUFBRTthQUNsRTtZQUNELDZCQUE2QixFQUFFLEVBQUU7WUFDakMsT0FBTztZQUNQLGNBQWMsRUFBRSxHQUFHO1NBQ3BCLENBQUM7S0FDSCxDQUFDO0NBQ0gsQ0FBQztBQUVGLE1BQU0saUNBQWlDLEdBQUcsQ0FDeEMsZ0JBQWtELEVBQ2xELEVBQUUsQ0FDRixpQ0FBaUMsQ0FDL0IsZ0JBQWdCLEVBQ2hCLDBCQUEwQixDQUMzQixDQUFDO0FBRUosTUFBTSxtQ0FBbUMsR0FBRyxDQUMxQyxnQkFBa0QsRUFDbEQsRUFBRSxDQUNGLGlDQUFpQyxDQUMvQixnQkFBZ0IsRUFDaEIsNEJBQTRCLENBQzdCLENBQUM7QUFFSixNQUFNLGlDQUFpQyxHQUFHLENBQ3hDLGdCQUFrRCxFQUNsRCxRQUErQixFQUMvQixFQUFFO0lBQ0YsTUFBTSxzQkFBc0IsR0FBRyxnQkFBZ0IsQ0FBQyxrQkFBa0I7U0FDL0QsbUJBQW1CLENBRWxCLGVBQWUsQ0FBQztRQUNsQixFQUFFLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQztTQUM5Qix5QkFBeUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN2QyxJQUFJLENBQUMsc0JBQXNCLEVBQUU7UUFDM0IsTUFBTSxJQUFJLEtBQUssQ0FDYixrQ0FDRSxRQUNGLHlIQUF5SCxDQUMxSCxDQUFDO0tBQ0g7SUFDRCxPQUFPLHNCQUFzQixDQUFDO0FBQ2hDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEF1dGhSb2xlTmFtZSxcbiAgQ29uc3RydWN0RmFjdG9yeUdldEluc3RhbmNlUHJvcHMsXG4gIFJlc291cmNlQWNjZXNzQWNjZXB0b3JGYWN0b3J5LFxuICBSZXNvdXJjZVByb3ZpZGVyLFxufSBmcm9tICdAYXdzLWFtcGxpZnkvcGx1Z2luLXR5cGVzJztcbmltcG9ydCB7IFN0b3JhZ2VBY2Nlc3NCdWlsZGVyIH0gZnJvbSAnLi90eXBlcy5qcyc7XG5pbXBvcnQgeyBlbnRpdHlJZFN1YnN0aXR1dGlvbiB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcblxuZXhwb3J0IGNvbnN0IHJvbGVBY2Nlc3NCdWlsZGVyOiBTdG9yYWdlQWNjZXNzQnVpbGRlciA9IHtcbiAgYXV0aGVudGljYXRlZDoge1xuICAgIHRvOiAoYWN0aW9ucykgPT4gKHtcbiAgICAgIGdldFJlc291cmNlQWNjZXNzQWNjZXB0b3JzOiBbZ2V0QXV0aFJvbGVSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yXSxcbiAgICAgIHVuaXF1ZURlZmluaXRpb25JZFZhbGlkYXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB1bmlxdWVEZWZpbml0aW9uSWQ6IGBhdXRoZW50aWNhdGVkYCxcbiAgICAgICAgICB2YWxpZGF0aW9uRXJyb3JPcHRpb25zOiB7XG4gICAgICAgICAgICBtZXNzYWdlOiBgRW50aXR5IGFjY2VzcyBkZWZpbml0aW9uIGZvciBhdXRoZW50aWNhdGVkIHVzZXJzIHNwZWNpZmllZCBtdWx0aXBsZSB0aW1lcy5gLFxuICAgICAgICAgICAgcmVzb2x1dGlvbjogYENvbWJpbmUgYWxsIGFjY2VzcyBkZWZpbml0aW9ucyBmb3IgYXV0aGVudGljYXRlZCB1c2VycyBvbiBhIHNpbmdsZSBwYXRoIGludG8gb25lIGFjY2VzcyBydWxlLmAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBhY3Rpb25zLFxuICAgICAgaWRTdWJzdGl0dXRpb246ICcqJyxcbiAgICB9KSxcbiAgfSxcbiAgZ3Vlc3Q6IHtcbiAgICB0bzogKGFjdGlvbnMpID0+ICh7XG4gICAgICBnZXRSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yczogW2dldFVuYXV0aFJvbGVSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yXSxcbiAgICAgIHVuaXF1ZURlZmluaXRpb25JZFZhbGlkYXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB1bmlxdWVEZWZpbml0aW9uSWQ6IGBndWVzdGAsXG4gICAgICAgICAgdmFsaWRhdGlvbkVycm9yT3B0aW9uczoge1xuICAgICAgICAgICAgbWVzc2FnZTogYEVudGl0eSBhY2Nlc3MgZGVmaW5pdGlvbiBmb3IgZ3Vlc3QgdXNlcnMgc3BlY2lmaWVkIG11bHRpcGxlIHRpbWVzLmAsXG4gICAgICAgICAgICByZXNvbHV0aW9uOiBgQ29tYmluZSBhbGwgYWNjZXNzIGRlZmluaXRpb25zIGZvciBndWVzdCB1c2VycyBvbiBhIHNpbmdsZSBwYXRoIGludG8gb25lIGFjY2VzcyBydWxlLmAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBhY3Rpb25zLFxuICAgICAgaWRTdWJzdGl0dXRpb246ICcqJyxcbiAgICB9KSxcbiAgfSxcbiAgZ3JvdXBzOiAoZ3JvdXBOYW1lcykgPT4gKHtcbiAgICB0bzogKGFjdGlvbnMpID0+ICh7XG4gICAgICBnZXRSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yczogZ3JvdXBOYW1lcy5tYXAoXG4gICAgICAgIChncm91cE5hbWUpID0+IChnZXRJbnN0YW5jZVByb3BzKSA9PlxuICAgICAgICAgIGdldFVzZXJSb2xlUmVzb3VyY2VBY2Nlc3NBY2NlcHRvcihnZXRJbnN0YW5jZVByb3BzLCBncm91cE5hbWUpXG4gICAgICApLFxuICAgICAgdW5pcXVlRGVmaW5pdGlvbklkVmFsaWRhdGlvbnM6IGdyb3VwTmFtZXMubWFwKChncm91cE5hbWUpID0+ICh7XG4gICAgICAgIHVuaXF1ZURlZmluaXRpb25JZDogYGdyb3VwcyR7Z3JvdXBOYW1lfWAsXG4gICAgICAgIHZhbGlkYXRpb25FcnJvck9wdGlvbnM6IHtcbiAgICAgICAgICBtZXNzYWdlOiBgR3JvdXAgYWNjZXNzIGRlZmluaXRpb24gZm9yICR7Z3JvdXBOYW1lfSBzcGVjaWZpZWQgbXVsdGlwbGUgdGltZXMuYCxcbiAgICAgICAgICByZXNvbHV0aW9uOiBgQ29tYmluZSBhbGwgYWNjZXNzIGRlZmluaXRpb25zIGZvciAke2dyb3VwTmFtZX0gb24gYSBzaW5nbGUgcGF0aCBpbnRvIG9uZSBhY2Nlc3MgcnVsZS5gLFxuICAgICAgICB9LFxuICAgICAgfSkpLFxuICAgICAgYWN0aW9ucyxcbiAgICAgIGlkU3Vic3RpdHV0aW9uOiAnKicsXG4gICAgfSksXG4gIH0pLFxuICBlbnRpdHk6IChlbnRpdHlJZCkgPT4gKHtcbiAgICB0bzogKGFjdGlvbnMpID0+ICh7XG4gICAgICBnZXRSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yczogW2dldEF1dGhSb2xlUmVzb3VyY2VBY2Nlc3NBY2NlcHRvcl0sXG4gICAgICB1bmlxdWVEZWZpbml0aW9uSWRWYWxpZGF0aW9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgdW5pcXVlRGVmaW5pdGlvbklkOiBgZW50aXR5JHtlbnRpdHlJZH1gLFxuICAgICAgICAgIHZhbGlkYXRpb25FcnJvck9wdGlvbnM6IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBFbnRpdHkgYWNjZXNzIGRlZmluaXRpb24gZm9yICR7ZW50aXR5SWR9IHNwZWNpZmllZCBtdWx0aXBsZSB0aW1lcy5gLFxuICAgICAgICAgICAgcmVzb2x1dGlvbjogYENvbWJpbmUgYWxsIGFjY2VzcyBkZWZpbml0aW9ucyBmb3IgJHtlbnRpdHlJZH0gb24gYSBzaW5nbGUgcGF0aCBpbnRvIG9uZSBhY2Nlc3MgcnVsZS5gLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgYWN0aW9ucyxcbiAgICAgIGlkU3Vic3RpdHV0aW9uOiBlbnRpdHlJZFN1YnN0aXR1dGlvbixcbiAgICB9KSxcbiAgfSksXG4gIHJlc291cmNlOiAob3RoZXIpID0+ICh7XG4gICAgdG86IChhY3Rpb25zKSA9PiAoe1xuICAgICAgZ2V0UmVzb3VyY2VBY2Nlc3NBY2NlcHRvcnM6IFtcbiAgICAgICAgKGdldEluc3RhbmNlUHJvcHMpID0+XG4gICAgICAgICAgb3RoZXIuZ2V0SW5zdGFuY2UoZ2V0SW5zdGFuY2VQcm9wcykuZ2V0UmVzb3VyY2VBY2Nlc3NBY2NlcHRvcigpLFxuICAgICAgXSxcbiAgICAgIHVuaXF1ZURlZmluaXRpb25JZFZhbGlkYXRpb25zOiBbXSxcbiAgICAgIGFjdGlvbnMsXG4gICAgICBpZFN1YnN0aXR1dGlvbjogJyonLFxuICAgIH0pLFxuICB9KSxcbn07XG5cbmNvbnN0IGdldEF1dGhSb2xlUmVzb3VyY2VBY2Nlc3NBY2NlcHRvciA9IChcbiAgZ2V0SW5zdGFuY2VQcm9wczogQ29uc3RydWN0RmFjdG9yeUdldEluc3RhbmNlUHJvcHNcbikgPT5cbiAgZ2V0VXNlclJvbGVSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yKFxuICAgIGdldEluc3RhbmNlUHJvcHMsXG4gICAgJ2F1dGhlbnRpY2F0ZWRVc2VySWFtUm9sZSdcbiAgKTtcblxuY29uc3QgZ2V0VW5hdXRoUm9sZVJlc291cmNlQWNjZXNzQWNjZXB0b3IgPSAoXG4gIGdldEluc3RhbmNlUHJvcHM6IENvbnN0cnVjdEZhY3RvcnlHZXRJbnN0YW5jZVByb3BzXG4pID0+XG4gIGdldFVzZXJSb2xlUmVzb3VyY2VBY2Nlc3NBY2NlcHRvcihcbiAgICBnZXRJbnN0YW5jZVByb3BzLFxuICAgICd1bmF1dGhlbnRpY2F0ZWRVc2VySWFtUm9sZSdcbiAgKTtcblxuY29uc3QgZ2V0VXNlclJvbGVSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yID0gKFxuICBnZXRJbnN0YW5jZVByb3BzOiBDb25zdHJ1Y3RGYWN0b3J5R2V0SW5zdGFuY2VQcm9wcyxcbiAgcm9sZU5hbWU6IEF1dGhSb2xlTmFtZSB8IHN0cmluZ1xuKSA9PiB7XG4gIGNvbnN0IHJlc291cmNlQWNjZXNzQWNjZXB0b3IgPSBnZXRJbnN0YW5jZVByb3BzLmNvbnN0cnVjdENvbnRhaW5lclxuICAgIC5nZXRDb25zdHJ1Y3RGYWN0b3J5PFxuICAgICAgUmVzb3VyY2VQcm92aWRlciAmIFJlc291cmNlQWNjZXNzQWNjZXB0b3JGYWN0b3J5PEF1dGhSb2xlTmFtZSB8IHN0cmluZz5cbiAgICA+KCdBdXRoUmVzb3VyY2VzJylcbiAgICA/LmdldEluc3RhbmNlKGdldEluc3RhbmNlUHJvcHMpXG4gICAgLmdldFJlc291cmNlQWNjZXNzQWNjZXB0b3Iocm9sZU5hbWUpO1xuICBpZiAoIXJlc291cmNlQWNjZXNzQWNjZXB0b3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgQ2Fubm90IHNwZWNpZnkgYXV0aCBhY2Nlc3MgZm9yICR7XG4gICAgICAgIHJvbGVOYW1lIGFzIHN0cmluZ1xuICAgICAgfSB1c2VycyB3aXRob3V0IGRlZmluaW5nIGF1dGguIFNlZSBodHRwczovL2RvY3MuYW1wbGlmeS5hd3MvZ2VuMi9idWlsZC1hLWJhY2tlbmQvYXV0aC9zZXQtdXAtYXV0aC8gZm9yIG1vcmUgaW5mb3JtYXRpb24uYFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHJlc291cmNlQWNjZXNzQWNjZXB0b3I7XG59O1xuIl19