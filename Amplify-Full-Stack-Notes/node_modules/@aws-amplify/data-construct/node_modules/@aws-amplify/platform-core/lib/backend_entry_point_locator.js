"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BackendLocator = void 0;
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const errors_1 = require("./errors");
/**
 * Find the backend definition file in the customer app that represents a CDK app.
 */
class BackendLocator {
    rootDir;
    relativePath = path_1.default.join('amplify', 'backend');
    // Give preference to JS if that exists over TS in case customers have their own compilation process.
    supportedFileExtensions = ['.js', '.mjs', '.cjs', '.ts'];
    /**
     * Constructor for BackendLocator
     */
    constructor(rootDir = process.cwd()) {
        this.rootDir = rootDir;
    }
    locate = () => {
        for (const fileExtension of this.supportedFileExtensions) {
            if (fs_1.default.existsSync(path_1.default.resolve(this.rootDir, this.relativePath + fileExtension))) {
                return this.relativePath + fileExtension;
            }
        }
        throw new errors_1.AmplifyUserError('FileConventionError', {
            message: `Amplify Backend not found in ${this.rootDir}.`,
            resolution: 'Amplify Backend must be defined in amplify/backend.(ts|js|cjs|mjs)',
        });
    };
}
exports.BackendLocator = BackendLocator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2VuZF9lbnRyeV9wb2ludF9sb2NhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2JhY2tlbmRfZW50cnlfcG9pbnRfbG9jYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsZ0RBQXdCO0FBQ3hCLHFDQUE0QztBQUU1Qzs7R0FFRztBQUNILE1BQWEsY0FBYztJQVFJO0lBUHJCLFlBQVksR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUV2RCxxR0FBcUc7SUFDN0YsdUJBQXVCLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNqRTs7T0FFRztJQUNILFlBQTZCLFVBQWtCLE9BQU8sQ0FBQyxHQUFHLEVBQUU7UUFBL0IsWUFBTyxHQUFQLE9BQU8sQ0FBd0I7SUFBRyxDQUFDO0lBRWhFLE1BQU0sR0FBRyxHQUFHLEVBQUU7UUFDWixLQUFLLE1BQU0sYUFBYSxJQUFJLElBQUksQ0FBQyx1QkFBdUIsRUFBRTtZQUN4RCxJQUNFLFlBQUUsQ0FBQyxVQUFVLENBQ1gsY0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxZQUFZLEdBQUcsYUFBYSxDQUFDLENBQzlELEVBQ0Q7Z0JBQ0EsT0FBTyxJQUFJLENBQUMsWUFBWSxHQUFHLGFBQWEsQ0FBQzthQUMxQztTQUNGO1FBRUQsTUFBTSxJQUFJLHlCQUFnQixDQUFDLHFCQUFxQixFQUFFO1lBQ2hELE9BQU8sRUFBRSxnQ0FBZ0MsSUFBSSxDQUFDLE9BQU8sR0FBRztZQUN4RCxVQUFVLEVBQ1Isb0VBQW9FO1NBQ3ZFLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztDQUNIO0FBM0JELHdDQTJCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IEFtcGxpZnlVc2VyRXJyb3IgfSBmcm9tICcuL2Vycm9ycyc7XG5cbi8qKlxuICogRmluZCB0aGUgYmFja2VuZCBkZWZpbml0aW9uIGZpbGUgaW4gdGhlIGN1c3RvbWVyIGFwcCB0aGF0IHJlcHJlc2VudHMgYSBDREsgYXBwLlxuICovXG5leHBvcnQgY2xhc3MgQmFja2VuZExvY2F0b3Ige1xuICBwcml2YXRlIHJlbGF0aXZlUGF0aCA9IHBhdGguam9pbignYW1wbGlmeScsICdiYWNrZW5kJyk7XG5cbiAgLy8gR2l2ZSBwcmVmZXJlbmNlIHRvIEpTIGlmIHRoYXQgZXhpc3RzIG92ZXIgVFMgaW4gY2FzZSBjdXN0b21lcnMgaGF2ZSB0aGVpciBvd24gY29tcGlsYXRpb24gcHJvY2Vzcy5cbiAgcHJpdmF0ZSBzdXBwb3J0ZWRGaWxlRXh0ZW5zaW9ucyA9IFsnLmpzJywgJy5tanMnLCAnLmNqcycsICcudHMnXTtcbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yIGZvciBCYWNrZW5kTG9jYXRvclxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSByb290RGlyOiBzdHJpbmcgPSBwcm9jZXNzLmN3ZCgpKSB7fVxuXG4gIGxvY2F0ZSA9ICgpID0+IHtcbiAgICBmb3IgKGNvbnN0IGZpbGVFeHRlbnNpb24gb2YgdGhpcy5zdXBwb3J0ZWRGaWxlRXh0ZW5zaW9ucykge1xuICAgICAgaWYgKFxuICAgICAgICBmcy5leGlzdHNTeW5jKFxuICAgICAgICAgIHBhdGgucmVzb2x2ZSh0aGlzLnJvb3REaXIsIHRoaXMucmVsYXRpdmVQYXRoICsgZmlsZUV4dGVuc2lvbilcbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbGF0aXZlUGF0aCArIGZpbGVFeHRlbnNpb247XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ0ZpbGVDb252ZW50aW9uRXJyb3InLCB7XG4gICAgICBtZXNzYWdlOiBgQW1wbGlmeSBCYWNrZW5kIG5vdCBmb3VuZCBpbiAke3RoaXMucm9vdERpcn0uYCxcbiAgICAgIHJlc29sdXRpb246XG4gICAgICAgICdBbXBsaWZ5IEJhY2tlbmQgbXVzdCBiZSBkZWZpbmVkIGluIGFtcGxpZnkvYmFja2VuZC4odHN8anN8Y2pzfG1qcyknLFxuICAgIH0pO1xuICB9O1xufVxuIl19